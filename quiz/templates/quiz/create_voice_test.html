<!-- create_voice_test.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–°–æ–∑–¥–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–π —Ç–µ—Å—Ç</title>
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/3.0.0/uicons-regular-chubby/css/uicons-regular-chubby.css'>
   <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/3.0.0/uicons-solid-straight/css/uicons-solid-straight.css'>
   <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/3.0.0/uicons-solid-straight/css/uicons-solid-straight.css'>
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/3.0.0/uicons-solid-rounded/css/uicons-solid-rounded.css'>
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/3.0.0/uicons-bold-rounded/css/uicons-bold-rounded.css'>
    {% load static %}
    <style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }

    :root {
        --primary: #6366f1;
        --primary-dark: #4f46e5;
        --secondary: #f59e0b;
        --success: #10b981;
        --danger: #ef4444;
        --dark: #1f2937;
        --light: #f8fafc;
        --gray: #6b7280;
        --border: #e5e7eb;
    }

    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        color: var(--dark);
        line-height: 1.6;
        padding: 20px;
    }

    .voice-test-container {
        max-width: 1400px;
        margin: 0 auto;
        display: grid;
        grid-template-columns: 1fr 400px;
        gap: 30px;
        align-items: start;
    }

    .glass-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-radius: 24px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .main-content {
        composes: glass-card;
        overflow: hidden;
    }

    .header {
        background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        padding: 30px;
        text-align: center;
        color: white;
        border-radius: 24px 24px 0 0;
    }

    .header h2 {
        font-size: 2.5em;
        margin-bottom: 10px;
        font-weight: 800;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 15px;
        text-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .header p {
        font-size: 1.1em;
        opacity: 0.9;
    }

    .content {
        padding: 40px;
        background: white;
    }

    .help-sidebar {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border-radius: 24px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        padding: 40px;
        position: sticky;
        top: 20px;
        height: fit-content;
    }

    .help-sidebar h2 {
        color: var(--dark);
        margin-bottom: 20px;
        font-size: 1.5em;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .help-item {
        padding: 20px;
        border-radius: 16px;
        margin-bottom: 15px;
    }

    .help-item:nth-child(2) {
        background: rgba(99, 102, 241, 0.1);
        border-left: 4px solid #6366f1;
    }

    .help-item:nth-child(3) {
        background: rgba(245, 158, 11, 0.1);
        border-left: 4px solid #f59e0b;
    }

    .help-item:nth-child(4) {
        background: rgba(16, 185, 129, 0.1);
        border-left: 4px solid #10b981;
    }

    .help-item:nth-child(5) {
        background: rgba(239, 68, 68, 0.1);
        border-left: 4px solid #ef4444;
    }

    .help-item:nth-child(6) {
        background: rgba(59, 130, 246, 0.1);
        border-left: 4px solid #3b82f6;
    }

    .help-item h4 {
        color: var(--dark);
        margin-bottom: 8px;
        font-size: 1.1em;
        font-weight: 600;
    }

    .help-item p {
        color: var(--dark);
        font-size: 0.9em;
        line-height: 1.5;
    }

    .format-badge {
        display: inline-block;
        background: var(--primary);
        color: white;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.8em;
        font-weight: 600;
        margin-right: 8px;
    }

    .question-section {
        background: #f8f9fa;
        padding: 25px;
        border-radius: 16px;
        margin: 20px 0;
        border-left: 4px solid #4facfe;
    }

    .answer-section {
        border: 2px dashed var(--primary);
        background: rgba(99, 102, 241, 0.05);
        padding: 20px;
        border-radius: 12px;
        margin: 15px 0;
        transition: all 0.3s ease;
    }

    .answer-section:hover {
        background: rgba(99, 102, 241, 0.08);
        border-color: var(--primary-dark);
    }

    .audio-controls {
        display: flex;
        gap: 10px;
        align-items: center;
        margin: 15px 0;
        flex-wrap: wrap;
    }

    .record-btn {
        padding: 12px 20px;
        background: #dc3545;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .record-btn.recording {
        background: #28a745;
        animation: pulse 1s infinite;
    }

    .record-btn:disabled {
        background: #6c757d;
        cursor: not-allowed;
        transform: none !important;
    }

    .record-btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }

    .audio-preview {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin: 15px 0;
        padding: 15px;
        background: #f8f9fa;
        border-radius: 8px;
        border: 1px solid var(--border);
    }

    .div-correct-option {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 15px;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 1px solid var(--border);
    }

    .delete-btn {
        background: #dc3545;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 20px;
        cursor: pointer;
        font-size: 0.9em;
        display: flex;
        align-items: center;
        gap: 5px;
        transition: all 0.3s ease;
    }

    .delete-btn:hover {
        background: #dc2626;
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(220, 53, 69, 0.3);
    }

    input[type="text"], textarea {
        width: 100%;
        padding: 15px;
        margin: 8px 0;
        border: 2px solid var(--border);
        border-radius: 12px;
        font-size: 1em;
        transition: all 0.3s ease;
    }
    .textareaa {
        width: 100%;
        padding: 15px;
        margin: 8px 0;
        border: 2px solid var(--border);
        border-radius: 12px;
        font-size: 1.3em;
        transition: all 0.3s ease;

    }

    textarea:focus, input[type="text"]:focus {
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        outline: none;
    }

    .info-panel {
        background: #e7f3ff;
        border-radius: 16px;
        padding: 25px;
        margin-bottom: 30px;
        border-left: 4px solid #4facfe;
    }

    .info-panel h3 {
        color: #2c3e50;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 1.3em;
    }

    .info-panel ul {
        color: #495057;
        padding-left: 20px;
    }

    .info-panel li {
        margin-bottom: 8px;
        line-height: 1.5;
    }

    .btn {
        display: inline-flex;
        align-items: center;
        gap: 10px;
        padding: 14px 25px;
        border: none;
        border-radius: 12px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
    }

    .add-question {
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        color: white;
    }

    .add-question:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
    }

    .submit-btn {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        color: white;
        padding: 16px 25px;
        font-size: 16px;
    }

    .submit-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
    }

    .button-container {
        display: flex;
        gap: 15px;
        margin: 30px 0;
        flex-wrap: wrap;
    }

    .button-container .btn {
        flex: 1;
        min-width: 200px;
        justify-content: center;
    }

    .add-answer {
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        color: white;
        padding: 12px 20px;
        font-size: 14px;
        margin-top: 10px;
    }

    .add-answer:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
    }

    .audio-upload {
        border: 2px dashed var(--primary);
        background: rgba(99, 102, 241, 0.05);
        padding: 15px;
        border-radius: 12px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
        margin: 10px 0;
    }

    .audio-upload:hover {
        background: rgba(99, 102, 241, 0.1);
        border-color: var(--primary-dark);
        transform: translateY(-1px);
    }

    .audio-upload-label {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        color: var(--primary);
        font-weight: 600;
        cursor: pointer;
    }

    .audio-upload input[type="file"] {
        display: none;
    }

    .audio-preview audio {
        width: 100%;
        border-radius: 8px;
        margin-top: 10px;
    }

    .audio-file-name {
        margin-top: 10px;
        font-size: 0.9em;
        color: var(--gray);
        word-break: break-all;
    }

    .correct-option {
        display: flex;
        align-items: center;
        gap: 12px;
        cursor: pointer;
        padding: 12px 20px;
        background: white;
        border-radius: 25px;
        transition: all 0.3s ease;
        border: 2px solid var(--border);
        flex: 1;
    }

    .correct-option:hover {
        border-color: var(--success);
        background: rgba(40, 167, 69, 0.05);
    }

    .correct-option input[type="radio"]:checked + .correct-badge {
        color: var(--success);
        font-weight: 600;
    }

    .correct-option:has(input[type="radio"]:checked) {
        border-color: var(--success);
        background: linear-gradient(135deg, #f8fff9 0%, #e8f5e8 100%);
        box-shadow: 0 2px 12px rgba(40, 167, 69, 0.2);
    }

    .correct-badge {
        font-weight: 500;
        color: var(--dark);
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 1024px) {
        .voice-test-container {
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .help-sidebar {
            position: static;
        }
    }

    @media (max-width: 768px) {
        body {
            padding: 15px;
        }

        .content {
            padding: 25px;
        }

        .header h2 {
            font-size: 2em;
        }

        .button-container {
            flex-direction: column;
        }

        .button-container .btn {
            min-width: auto;
        }

        .audio-controls {
            flex-direction: column;
            align-items: flex-start;
        }

        .div-correct-option {
            flex-direction: column;
            align-items: stretch;
        }

        .correct-option {
            width: 100%;
        }
    }
</style>
</head>
<body>
    <div class="voice-test-container">
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="main-content">
            <header class="header">
                <h2>
                    <span>
                        <i class="fi fi-rc-microphone"></i>
                    </span>
                    –°–æ–∑–¥–∞—Ç—å –≥–æ–ª–æ—Å–æ–≤–æ–π —Ç–µ—Å—Ç
                </h2>
                <p>–î–æ–±–∞–≤—å—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –∏ –æ—Ç–≤–µ—Ç—ã –¥–ª—è –≤–∞—à–µ–≥–æ —Ç–µ—Å—Ç–∞</p>
            </header>

            <div class="content">
                <div class="info-panel">
                    <h3>üí° –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</h3>
                    <ul>
                        <li>–î–æ–±–∞–≤—å—Ç–µ –º–∏–Ω–∏–º—É–º 1 –≤–æ–ø—Ä–æ—Å –∏ 2 –æ—Ç–≤–µ—Ç–∞</li>
                        <li>–û—Ç–º–µ—Ç—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞</li>
                        <li>–í—ã –º–æ–∂–µ—Ç–µ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤</li>
                    </ul>
                </div>

                <form method="post" enctype="multipart/form-data" id="voiceTestForm">
                    {% csrf_token %}

                    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—Å–µ—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ -->
                    <div id="questionsContainer">
                        <!-- –ü–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å -->
                        <div class="question-section" data-question-index="0">
                            <h3>–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–æ–ø—Ä–æ—Å 1</h3>

                            <label>–¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
                            <textarea name="question_text_0" placeholder="–û–ø–∏—à–∏—Ç–µ –≤–æ–ø—Ä–æ—Å —Ç–µ–∫—Å—Ç–æ–º..." class="textareaa"></textarea>

                            <div class="audio-controls">
                                <strong>–ó–∞–ø–∏—Å—å –≤–æ–ø—Ä–æ—Å–∞:</strong>
                                <button type="button" class="record-btn record-question-btn" data-question="0">
                                    <i class="fi fi-rc-microphone"></i> –ó–∞–ø–∏—Å–∞—Ç—å –≤–æ–ø—Ä–æ—Å
                                </button>
                                <button type="button" class="record-btn stop-question-btn" data-question="0" disabled>
                                    <i class="fi fi-br-stop-circle"></i> –°—Ç–æ–ø
                                </button>
                                <span>–∏–ª–∏</span>

                                <div class="audio-upload">
                                    <label class="audio-upload-label">
                                        <span><i class="fi fi-ss-music-alt"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞—É–¥–∏–æ —Ñ–∞–π–ª</span>
                                        <input type="file" name="question_audio_0" accept="audio/*" class="audio-file-input">
                                    </label>
                                    <div class="audio-preview" style="display: none;">
                                        <audio controls class="audio-preview-player"></audio>
                                        <div class="audio-file-name"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="audio-preview" id="questionAudioPreview0"></div>

                            <!-- –°–µ–∫—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ -->
                            <div style="margin-top: 20px;">
                                <h4>–ì–æ–ª–æ—Å–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞ 1</h4>
                                <p>–ó–∞–ø–∏—à–∏—Ç–µ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤. –û—Ç–º–µ—Ç—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç.</p>

                                <div id="answersContainer0">
                                    <!-- –û—Ç–≤–µ—Ç 1 -->
                                    <div class="answer-section" data-answer-index="0" data-question="0">
                                        <h5>–û—Ç–≤–µ—Ç 1</h5>
                                        <input type="text" name="answer_text_0[]" placeholder="–¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)">

                                        <div class="audio-controls">
                                            <strong>–ó–∞–ø–∏—Å—å –æ—Ç–≤–µ—Ç–∞:</strong>
                                            <button type="button" class="record-btn record-answer-btn" data-index="0" data-question="0">
                                                <i class="fi fi-rc-microphone"></i> –ó–∞–ø–∏—Å–∞—Ç—å –æ—Ç–≤–µ—Ç 1
                                            </button>
                                            <button type="button" class="record-btn stop-answer-btn" data-index="0" data-question="0" disabled>
                                                <i class="fi fi-br-stop-circle"></i> –°—Ç–æ–ø
                                            </button>
                                            <span>–∏–ª–∏</span>
                                            <div class="audio-upload">
                                                <label class="audio-upload-label">
                                                    <span><i class="fi fi-ss-music-alt"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞—É–¥–∏–æ —Ñ–∞–π–ª</span>
                                                    <input type="file" name="answer_audio_0[]" accept="audio/*" class="audio-file-input">
                                                </label>
                                                <div class="audio-preview" style="display: none;">
                                                    <audio controls class="audio-preview-player"></audio>
                                                    <div class="audio-file-name"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="audio-preview" id="answerAudioPreview0_0"></div>

                                        <div class="div-correct-option">
                                            <label class="correct-option">
                                                <input type="radio" name="correct_answer_0" value="0" required>
                                                <span class="correct-badge">–≠—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç</span>
                                            </label>

                                            <button type="button" class="delete-btn" onclick="removeAnswer(this, 0)">
                                                <i class="fi fi-sr-trash"></i> –£–¥–∞–ª–∏—Ç—å
                                            </button>
                                        </div>
                                    </div>

                                    <!-- –û—Ç–≤–µ—Ç 2 -->
                                    <div class="answer-section" data-answer-index="1" data-question="0">
                                        <h5>–û—Ç–≤–µ—Ç 2</h5>
                                        <input type="text" name="answer_text_0[]" placeholder="–¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)">

                                        <div class="audio-controls">
                                            <strong>–ó–∞–ø–∏—Å—å –æ—Ç–≤–µ—Ç–∞:</strong>
                                            <button type="button" class="record-btn record-answer-btn" data-index="1" data-question="0">
                                                <i class="fi fi-rc-microphone"></i> –ó–∞–ø–∏—Å–∞—Ç—å –æ—Ç–≤–µ—Ç 2
                                            </button>
                                            <button type="button" class="record-btn stop-answer-btn" data-index="1" data-question="0" disabled>
                                                <i class="fi fi-br-stop-circle"></i> –°—Ç–æ–ø
                                            </button>
                                            <span>–∏–ª–∏</span>
                                            <div class="audio-upload">
                                                <label class="audio-upload-label">
                                                    <span><i class="fi fi-ss-music-alt"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞—É–¥–∏–æ —Ñ–∞–π–ª</span>
                                                    <input type="file" name="answer_audio_0[]" accept="audio/*" class="audio-file-input">
                                                </label>
                                                <div class="audio-preview" style="display: none;">
                                                    <audio controls class="audio-preview-player"></audio>
                                                    <div class="audio-file-name"></div>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="audio-preview" id="answerAudioPreview0_1"></div>

                                        <div class="div-correct-option">
                                            <label class="correct-option">
                                                <input type="radio" name="correct_answer_0" value="1" required>
                                                <span class="correct-badge">–≠—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç</span>
                                            </label>

                                            <button type="button" class="delete-btn" onclick="removeAnswer(this, 0)">
                                                <i class="fi fi-sr-trash"></i> –£–¥–∞–ª–∏—Ç—å
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <button type="button" class="btn add-answer" onclick="addAnswerToQuestion(0)">
                                    <i class="fi fi-br-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –µ—â–µ –æ—Ç–≤–µ—Ç
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="button-container">
                        <button type="button" id="addQuestionBtn" class="btn add-question">
                            <i class="fi fi-br-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å
                        </button>

                        <button type="submit" class="btn submit-btn">
                            <i class="fi fi-ss-check-circle"></i> –ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="help-sidebar">
            <h2>üí° –ü–æ–¥—Å–∫–∞–∑–∫–∏</h2>

            <div class="help-item">
                <h4><span class="format-badge"><i class="fi fi-sr-microphone"></i></span>–ó–∞–ø–∏—Å—å –≥–æ–ª–æ—Å–∞</h4>
                <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É –∑–∞–ø–∏—Å–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥–æ–ª–æ—Å–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –æ—Ç–≤–µ—Ç–æ–≤. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –º–∏–∫—Ä–æ—Ñ–æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç.</p>
            </div>

            <div class="help-item">
                <h4><span class="format-badge"><i class="fi fi-sr-music"></i></span>–ó–∞–≥—Ä—É–∑–∫–∞ –∞—É–¥–∏–æ</h4>
                <p>–ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –≥–æ—Ç–æ–≤—ã–µ –∞—É–¥–∏–æ—Ñ–∞–π–ª—ã –≤ —Ñ–æ—Ä–º–∞—Ç–∞—Ö MP3, WAV, OGG.</p>
            </div>

            <div class="help-item">
                <h4><span class="format-badge"><i class="fi fi-br-check"></i></span>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã</h4>
                <p>–ù–µ –∑–∞–±—É–¥—å—Ç–µ –æ—Ç–º–µ—Ç–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ —Ä–∞–¥–∏–æ-–∫–Ω–æ–ø–∫–æ–π.</p>
            </div>

            <div class="help-item">
                <h4><span class="format-badge"><i class="fi fi-sr-add"></i></span>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤</h4>
                <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å" –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ –æ–¥–Ω–æ–º —Ç–µ—Å—Ç–µ.</p>
            </div>

            <div class="help-item">
                <h4>üí° –°–æ–≤–µ—Ç—ã –ø–æ –∑–∞–ø–∏—Å–∏</h4>
                <p>‚Ä¢ –ì–æ–≤–æ—Ä–∏—Ç–µ —á–µ—Ç–∫–æ –∏ —Ä–∞–∑–±–æ—Ä—á–∏–≤–æ</p>
                <p>‚Ä¢ –ó–∞–ø–∏—Å—ã–≤–∞–π—Ç–µ –≤ —Ç–∏—Ö–æ–º –ø–æ–º–µ—â–µ–Ω–∏–∏</p>
                <p>‚Ä¢ –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –∑–∞–ø–∏—Å—å –ø–µ—Ä–µ–¥ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º</p>
                <p>‚Ä¢ –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–ø–∏—Å–∏ 10-30 —Å–µ–∫—É–Ω–¥</p>
            </div>
        </div>
    </div>



    <script>
        let questionCount = 1;
        let mediaRecorder = null;
        let audioChunks = [];
        let currentRecordingType = null;

        // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =====
        document.addEventListener('DOMContentLoaded', function() {
            initEventListeners();
            initAudioUploads();
        });

        function initEventListeners() {
            document.getElementById('addQuestionBtn').addEventListener('click', addNewQuestion);

            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('record-answer-btn') || e.target.closest('.record-answer-btn')) {
                    const btn = e.target.classList.contains('record-answer-btn') ? e.target : e.target.closest('.record-answer-btn');
                    const index = btn.getAttribute('data-index');
                    const questionIndex = btn.getAttribute('data-question');
                    startRecording(`answer-${questionIndex}-${index}`);
                }

                if (e.target.classList.contains('stop-answer-btn') || e.target.closest('.stop-answer-btn')) {
                    stopRecording();
                }

                if (e.target.classList.contains('record-question-btn') || e.target.closest('.record-question-btn')) {
                    const btn = e.target.classList.contains('record-question-btn') ? e.target : e.target.closest('.record-question-btn');
                    const questionIndex = btn.getAttribute('data-question');
                    startRecording(`question-${questionIndex}`);
                }

                if (e.target.classList.contains('stop-question-btn') || e.target.closest('.stop-question-btn')) {
                    stopRecording();
                }
            });
        }

        function initAudioUploads() {
            const audioUploads = document.querySelectorAll('.audio-upload:not([data-initialized])');

            audioUploads.forEach(upload => {
                upload.setAttribute('data-initialized', 'true');

                const input = upload.querySelector('input[type="file"]');
                const preview = upload.querySelector('.audio-preview');
                const audio = upload.querySelector('audio');
                const fileName = upload.querySelector('.audio-file-name');
                const label = upload.querySelector('.audio-upload-label');

                label.addEventListener('click', function(e) {
                    e.preventDefault();
                    input.click();
                });

                input.addEventListener('change', function(e) {
                    if (this.files && this.files[0]) {
                        const file = this.files[0];
                        preview.style.display = 'block';

                        if (audio.src) {
                            URL.revokeObjectURL(audio.src);
                        }

                        audio.src = URL.createObjectURL(file);
                        fileName.textContent = file.name;
                        audio.load();
                    } else {
                        preview.style.display = 'none';
                    }
                });

                input.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            });
        }

        function addNewQuestion() {
    const questionsContainer = document.getElementById('questionsContainer');
    const newQuestionIndex = questionCount++;

    const newQuestionHTML = `
        <div class="question-section" data-question-index="${newQuestionIndex}">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                <h1>–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–æ–ø—Ä–æ—Å ${newQuestionIndex + 1}</h1>
                <button type="button" class="delete-btn" onclick="removeQuestion(this)">
                    <i class="fi fi-sr-trash"></i> –£–¥–∞–ª–∏—Ç—å –≤–æ–ø—Ä–æ—Å
                </button>
            </div>

            <label>–¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</label>
            <textarea name="question_text_${newQuestionIndex}" placeholder="–û–ø–∏—à–∏—Ç–µ –≤–æ–ø—Ä–æ—Å —Ç–µ–∫—Å—Ç–æ–º..." class="textareaa"></textarea>

            <div class="audio-controls">
                <strong>–ó–∞–ø–∏—Å—å –≤–æ–ø—Ä–æ—Å–∞:</strong>
                <button type="button" class="record-btn record-question-btn" data-question="${newQuestionIndex}">
                    <i class="fi fi-rc-microphone"></i> –ó–∞–ø–∏—Å–∞—Ç—å –≤–æ–ø—Ä–æ—Å
                </button>
                <button type="button" class="record-btn stop-question-btn" data-question="${newQuestionIndex}" disabled>
                    <i class="fi fi-br-stop-circle"></i> –°—Ç–æ–ø
                </button>
                <span>–∏–ª–∏</span>

                <div class="audio-upload">
                    <label class="audio-upload-label">
                        <span><i class="fi fi-ss-music-alt"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞—É–¥–∏–æ —Ñ–∞–π–ª</span>
                        <input type="file" name="question_audio_${newQuestionIndex}" accept="audio/*">
                    </label>
                    <div class="audio-preview" style="display: none;">
                        <audio controls></audio>
                        <div class="audio-file-name"></div>
                    </div>
                </div>
            </div>

            <div class="audio-preview" id="questionAudioPreview${newQuestionIndex}"></div>

            <!-- –°–µ–∫—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤ -->
            <div style="margin-top: 20px;">
                <h3>–ì–æ–ª–æ—Å–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞ ${newQuestionIndex + 1}</h3>
                <p>–ó–∞–ø–∏—à–∏—Ç–µ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤. –û—Ç–º–µ—Ç—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç.</p>

                <div id="answersContainer${newQuestionIndex}">
                </div>

                <button type="button" class="btn add-answer" onclick="addAnswerToQuestion(${newQuestionIndex})">
                    <i class="fi fi-br-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –µ—â–µ –æ—Ç–≤–µ—Ç
                </button>
            </div>
        </div>
    `;

    questionsContainer.insertAdjacentHTML('beforeend', newQuestionHTML);
    addAnswerToQuestion(newQuestionIndex);
    addAnswerToQuestion(newQuestionIndex);
    initAudioUploads();
}

       function addAnswerToQuestion(questionIndex) {
    const answersContainer = document.getElementById(`answersContainer${questionIndex}`);
    if (!answersContainer) return;

    const answerCount = answersContainer.children.length;
    const newIndex = answerCount;

    const newAnswerHTML = `
        <div class="answer-section" data-answer-index="${newIndex}" data-question="${questionIndex}">
            <h4>–û—Ç–≤–µ—Ç ${newIndex + 1}</h4>
            <input type="text" name="answer_text_${questionIndex}[]" placeholder="–¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)">

            <div class="audio-controls">
                <strong>–ó–∞–ø–∏—Å—å –æ—Ç–≤–µ—Ç–∞:</strong>
                <button type="button" class="record-btn record-answer-btn" data-index="${newIndex}" data-question="${questionIndex}">
                    <i class="fi fi-rc-microphone"></i> –ó–∞–ø–∏—Å–∞—Ç—å –æ—Ç–≤–µ—Ç ${newIndex + 1}
                </button>
                <button type="button" class="record-btn stop-answer-btn" data-index="${newIndex}" data-question="${questionIndex}" disabled>
                    <i class="fi fi-br-stop-circle"></i> –°—Ç–æ–ø
                </button>
                <span>–∏–ª–∏</span>
                <div class="audio-upload">
                    <label class="audio-upload-label">
                        <span><i class="fi fi-ss-music-alt"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞—É–¥–∏–æ —Ñ–∞–π–ª</span>
                        <input type="file" name="answer_audio_${questionIndex}[]" accept="audio/*">
                    </label>
                    <div class="audio-preview" style="display: none;">
                        <audio controls></audio>
                        <div class="audio-file-name"></div>
                    </div>
                </div>
            </div>

            <div class="audio-preview" id="answerAudioPreview${questionIndex}_${newIndex}"></div>

            <div class="div-correct-option">
                <label class="correct-option">
                    <input type="radio" name="correct_answer_${questionIndex}" value="${newIndex}" required>
                    <span class="correct-badge">–≠—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç</span>
                </label>

                <button type="button" class="delete-btn" onclick="removeAnswer(this, ${questionIndex})">
                    <i class="fi fi-sr-trash"></i> –£–¥–∞–ª–∏—Ç—å
                </button>
            </div>
        </div>
    `;

    answersContainer.insertAdjacentHTML('beforeend', newAnswerHTML);
    initAudioUploads();
}
        // ===== –£–î–ê–õ–ï–ù–ò–ï –í–û–ü–†–û–°–ê =====
        function removeQuestion(button) {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å?')) {
                const questionSection = button.closest('.question-section');
                questionSection.remove();
                updateQuestionNumbers();
            }
        }

        // ===== –£–î–ê–õ–ï–ù–ò–ï –û–¢–í–ï–¢–ê =====
        function removeAnswer(button, questionIndex) {
            const answerSection = button.closest('.answer-section');
            const answersContainer = document.getElementById(`answersContainer${questionIndex}`);

            if (answersContainer && answersContainer.children.length > 2) {
                if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –æ—Ç–≤–µ—Ç?')) {
                    answerSection.remove();
                    updateAnswerNumbers(questionIndex);
                }
            } else {
                alert('–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 2 –æ—Ç–≤–µ—Ç–∞!');
            }
        }

        // ===== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ù–û–ú–ï–†–û–í –í–û–ü–†–û–°–û–í =====
        function updateQuestionNumbers() {
            const questionSections = document.querySelectorAll('.question-section');
            questionSections.forEach((section, index) => {
                section.setAttribute('data-question-index', index);
                const header = section.querySelector('h1');
                if (header) {
                    header.textContent = `–ì–æ–ª–æ—Å–æ–≤–æ–π –≤–æ–ø—Ä–æ—Å ${index + 1}`;
                }

                const answersHeader = section.querySelector('div > h3');
                if (answersHeader) {
                    answersHeader.textContent = `–ì–æ–ª–æ—Å–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞ ${index + 1}`;
                }
            });
            questionCount = questionSections.length;
        }

        // ===== –û–ë–ù–û–í–õ–ï–ù–ò–ï –ù–û–ú–ï–†–û–í –û–¢–í–ï–¢–û–í =====
        function updateAnswerNumbers(questionIndex) {
            const answersContainer = document.getElementById(`answersContainer${questionIndex}`);
            if (!answersContainer) return;

            const answerSections = answersContainer.querySelectorAll('.answer-section');

            answerSections.forEach((section, index) => {
                section.setAttribute('data-answer-index', index);
                const title = section.querySelector('h4');
                title.textContent = `–û—Ç–≤–µ—Ç ${index + 1}`;

                const recordBtn = section.querySelector('.record-answer-btn');
                const stopBtn = section.querySelector('.stop-answer-btn');
                if (recordBtn && stopBtn) {
                    recordBtn.setAttribute('data-index', index);
                    recordBtn.innerHTML = `<i class="fi fi-rc-microphone"></i> –ó–∞–ø–∏—Å–∞—Ç—å –æ—Ç–≤–µ—Ç ${index + 1}`;
                    stopBtn.setAttribute('data-index', index);
                }

                const radio = section.querySelector('input[type="radio"]');
                if (radio) {
                    radio.value = index;
                }
            });
        }

        // ===== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò –ó–ê–ü–ò–°–ò =====
        async function startRecording(type) {
            try {
                console.log('–ù–∞—á–∞–ª–æ –∑–∞–ø–∏—Å–∏:', type);
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = [];
                currentRecordingType = type;

                mediaRecorder.ondataavailable = (event) => {
                    if (event.data.size > 0) {
                        audioChunks.push(event.data);
                    }
                };

                mediaRecorder.onstop = () => {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                    const audioUrl = URL.createObjectURL(audioBlob);

                    const audioElement = document.createElement('audio');
                    audioElement.controls = true;
                    audioElement.src = audioUrl;
                    audioElement.style.width = '100%';
                    audioElement.style.marginTop = '10px';

                    const fileInput = document.createElement('input');
                    fileInput.type = 'file';
                    fileInput.name = getFileNameByType(type);
                    fileInput.style.display = 'none';

                    const file = new File([audioBlob], getFileNameByType(type) + '.webm', { type: 'audio/webm' });
                    const dataTransfer = new DataTransfer();
                    dataTransfer.items.add(file);
                    fileInput.files = dataTransfer.files;

                    updateUIAfterRecording(type, audioElement, fileInput);
                    stream.getTracks().forEach(track => track.stop());
                };

                mediaRecorder.start();
                updateUIDuringRecording(type, true);

            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–ø–∏—Å–∏:', error);
                alert('–û—à–∏–±–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –º–∏–∫—Ä–æ—Ñ–æ–Ω—É: ' + error.message);
            }
        }

        function stopRecording() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                mediaRecorder.stop();
                updateUIDuringRecording(currentRecordingType, false);
            }
        }

        function getFileNameByType(type) {
            if (type.startsWith('question-')) {
                const questionIndex = type.split('-')[1];
                return `question_audio_${questionIndex}`;
            }
            if (type.startsWith('answer-')) {
                const parts = type.split('-');
                const questionIndex = parts[1];
                return `answer_audio_${questionIndex}[]`;
            }
            return 'audio';
        }

        function updateUIDuringRecording(type, isRecording) {
            let recordBtn, stopBtn;

            if (type.startsWith('question-')) {
                const questionIndex = type.split('-')[1];
                recordBtn = document.querySelector(`.record-question-btn[data-question="${questionIndex}"]`);
                stopBtn = document.querySelector(`.stop-question-btn[data-question="${questionIndex}"]`);
            } else if (type.startsWith('answer-')) {
                const parts = type.split('-');
                const questionIndex = parts[1];
                const answerIndex = parts[2];

                recordBtn = document.querySelector(`.record-answer-btn[data-question="${questionIndex}"][data-index="${answerIndex}"]`);
                stopBtn = document.querySelector(`.stop-answer-btn[data-question="${questionIndex}"][data-index="${answerIndex}"]`);
            }

            if (recordBtn && stopBtn) {
                if (isRecording) {
                    recordBtn.disabled = true;
                    recordBtn.classList.add('recording');
                    recordBtn.innerHTML = '<i class="fi fi-rc-microphone"></i> –ó–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è...';
                    stopBtn.disabled = false;
                } else {
                    recordBtn.disabled = false;
                    recordBtn.classList.remove('recording');

                    if (type.startsWith('question-')) {
                        recordBtn.innerHTML = '<i class="fi fi-rc-microphone"></i> –ó–∞–ø–∏—Å–∞—Ç—å –≤–æ–ø—Ä–æ—Å';
                    } else if (type.startsWith('answer-')) {
                        const parts = type.split('-');
                        const answerIndex = parts[2];
                        recordBtn.innerHTML = `<i class="fi fi-rc-microphone"></i> –ó–∞–ø–∏—Å–∞—Ç—å –æ—Ç–≤–µ—Ç ${parseInt(answerIndex) + 1}`;
                    }

                    stopBtn.disabled = true;
                }
            }
        }

        function updateUIAfterRecording(type, audioElement, fileInput) {
            let preview;

            if (type.startsWith('question-')) {
                const questionIndex = type.split('-')[1];
                preview = document.getElementById(`questionAudioPreview${questionIndex}`);
            } else if (type.startsWith('answer-')) {
                const parts = type.split('-');
                const questionIndex = parts[1];
                const answerIndex = parts[2];
                preview = document.getElementById(`answerAudioPreview${questionIndex}_${answerIndex}`);
            }

            if (preview) {
                preview.innerHTML = '';

                const title = document.createElement('strong');
                if (type.startsWith('question')) {
                    title.textContent = '–í–∞—à–∞ –∑–∞–ø–∏—Å—å –≤–æ–ø—Ä–æ—Å–∞:';
                } else {
                    const parts = type.split('-');
                    const answerIndex = parts[2];
                    title.textContent = `–ó–∞–ø–∏—Å—å –æ—Ç–≤–µ—Ç–∞ ${parseInt(answerIndex) + 1}:`;
                }

                preview.appendChild(title);
                preview.appendChild(document.createElement('br'));
                preview.appendChild(audioElement);
                preview.appendChild(fileInput);

                preview.style.display = 'block';
                preview.style.padding = '10px';
                preview.style.marginTop = '10px';
                preview.style.background = '#f8f9fa';
                preview.style.borderRadius = '5px';
            }
        }

        // ===== –£–ü–†–û–©–ï–ù–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê =====
// ===== –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –ü–ï–†–ï–î –û–¢–ü–†–ê–í–ö–û–ô =====
document.getElementById('voiceTestForm').addEventListener('submit', function(e) {
    // –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
    console.log('=== –î–ê–ù–ù–´–ï –§–û–†–ú–´ ===');

    const formData = new FormData(this);
    console.log('üìã –í—Å–µ –ø–æ–ª—è —Ñ–æ—Ä–º—ã:');
    for (let [key, value] of formData.entries()) {
        if (value instanceof File) {
            console.log(`   ${key}: FILE - ${value.name}`);
        } else {
            console.log(`   ${key}: ${value}`);
        }
    }

    // –°—á–∏—Ç–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã
    const questionSections = document.querySelectorAll('.question-section');
    console.log(`üìä –í—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤: ${questionSections.length}`);

    questionSections.forEach((section, index) => {
        const questionIndex = section.getAttribute('data-question-index');
        const answers = section.querySelectorAll('.answer-section');
        const correctAnswer = section.querySelector(`input[name="correct_answer_${questionIndex}"]:checked`);

        console.log(`   –í–æ–ø—Ä–æ—Å ${questionIndex}:`);
        console.log(`     - –û—Ç–≤–µ—Ç–æ–≤: ${answers.length}`);
        console.log(`     - –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ${correctAnswer ? correctAnswer.value : '–ù–ï –í–´–ë–†–ê–ù'}`);
    });

    console.log('===================');
});
    </script>
</body>
</html>
