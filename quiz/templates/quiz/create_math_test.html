<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/3.0.0/uicons-solid-rounded/css/uicons-solid-rounded.css'>
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/3.0.0/uicons-solid-rounded/css/uicons-solid-rounded.css'>
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/3.0.0/uicons-solid-straight/css/uicons-solid-straight.css'>
    <link rel='stylesheet' href='https://cdn-uicons.flaticon.com/3.0.0/uicons-bold-rounded/css/uicons-bold-rounded.css'>
    <title>–°–æ–∑–¥–∞—Ç—å –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¢–µ—Å—Ç</title>
    <style>
        {% load static %}
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .math-test-container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
        }

        .main-content {
            background: white;
            border-radius: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            padding: 30px;
            text-align: center;
            color: white;
        }

        .content {
            padding: 40px;
        }

        .help-sidebar {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .help-sidebar h2 {
    color: #6366f1;
    margin-bottom: 25px;
    font-size: 1.4em;
    text-align: center;
    border-bottom: 2px solid #e5e7eb;
    padding-bottom: 15px;
}

.help-item {
    background: white;
    border-radius: 12px;
    padding: 18px;
    margin-bottom: 16px;
    border: 1px solid #e5e7eb;
    transition: all 0.3s ease;
}

.help-item:hover {
    border-color: #6366f1;
    box-shadow: 0 4px 12px rgba(99, 102, 241, 0.1);
}

.help-item h4 {
    color: #374151;
    margin: 0 0 10px 0;
    font-size: 1em;
    display: flex;
    align-items: center;
    gap: 8px;
}

.help-item p {
    color: #6b7280;
    margin: 8px 0;
    font-size: 0.9em;
    line-height: 1.5;
}

.help-item ul {
    color: #6b7280;
    margin: 8px 0;
    padding-left: 20px;
    font-size: 0.9em;
}

.help-item li {
    margin-bottom: 4px;
    line-height: 1.4;
}

.help-examples {
    background: linear-gradient(135deg, #f0f4ff 0%, #f8faff 100%);
    border-radius: 12px;
    padding: 20px;
    margin: 20px 0;
    border: 1px solid #e0e7ff;
}

.help-examples h4 {
    color: #4f46e5;
    margin: 0 0 15px 0;
    font-size: 1.1em;
}

.example {
    background: white;
    border-radius: 8px;
    padding: 12px;
    margin-bottom: 12px;
    border-left: 4px solid #6366f1;
}

.example strong {
    color: #374151;
    display: block;
    margin-bottom: 6px;
}

.example p {
    color: #6b7280;
    margin: 0;
    font-size: 0.85em;
    line-height: 1.4;
}

.help-tip {
    background: linear-gradient(135deg, #f0fff4 0%, #f8fff8 100%);
    border-radius: 12px;
    padding: 18px;
    border: 1px solid #d1fae5;
}

.help-tip h4 {
    color: #059669;
    margin: 0 0 8px 0;
    font-size: 1em;
}

.help-tip p {
    color: #065f46;
    margin: 0;
    font-size: 0.9em;
    line-height: 1.5;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 1024px) {
    .help-sidebar {
        position: static;
        margin-top: 30px;
    }
}

        .format-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .format-button {
            display: block;
            cursor: pointer;
        }

        .format-button input[type="radio"] {
            display: none;
        }

        .format-button-content {
            border: 2px solid #e5e7eb;
            background: white;
            padding: 20px 15px;
            border-radius: 16px;
            text-align: center;
            transition: all 0.3s ease;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .format-button input[type="radio"]:checked + .format-button-content {
            border-color: #6366f1;
            background: rgba(99, 102, 241, 0.05);
        }

        .format-icon {
            font-size: 2em;
        }

        .format-text {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .format-text strong {
            font-weight: 600;
        }

        .format-text small {
            color: #6b7280;
            font-size: 0.8em;
        }

        .question-section, .answers-section {
            margin: 30px 0;
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 1em;
            margin: 10px 0;
            resize: vertical;
        }

        .keyboard-toggle {
            background: #6366f1;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px 0;
            transition: all 0.3s ease;
        }

        .keyboard-toggle:hover {
            background: #4f46e5;
        }

        .math-preview {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            min-height: 50px;
            border: 2px dashed #dee2e6;
            font-family: 'Times New Roman', serif;
            font-size: 18px;
        }

        .answer-item {
            background: white;
            padding: 20px;
            border-radius: 16px;
            border: 2px solid #e5e7eb;
            margin: 15px 0;
        }

        .correct-answer {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
            cursor: pointer;
        }

        .add-button, .btn {
            background: #6366f1;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            margin: 5px;
        }
         .submit-btn {
            background: #10b981;
         }

        .btn-primary {
            background: #6366f1;
        }

        .delete-button {
            background: #ef4444;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        /* –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã */
        .math-keyboard-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .math-keyboard-modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            max-width: 1200px;
            width: 95%;
            max-height: 90vh;
            overflow-y: auto;
            margin: 20px;
        }

        /* –°—Ç–∏–ª–∏ –≤–∞—à–µ–π –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã */
        .keyboard-container {
            padding: 0;
        }

        .keyboard-header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 15px 15px 0 0;
        }

        .formula-display {
            background: #f8f9fa;
            padding: 20px;
            min-height: 80px;
            border-bottom: 2px solid #e9ecef;
            font-size: 24px;
            text-align: center;
            font-family: 'Times New Roman', serif;
            word-wrap: break-word;
            line-height: 1.5;
        }

        .keyboard-tabs {
            display: flex;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            overflow-x: auto;
        }

        .keyboard-tab {
            padding: 15px 20px;
            color: white;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 14px;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .keyboard-tab.active {
            background: rgba(255,255,255,0.2);
        }

        .keyboard-panel {
            background: #ecf0f1;
            padding: 20px;
            min-height: 200px;
            display: none;
        }

        .keyboard-panel.active {
            display: block;
        }

        .keyboard-section {
            margin-bottom: 15px;
        }

        .keyboard-row {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .key {
            min-width: 70px;
            padding: 15px 10px;
            background: white;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            font-size: 16px;
            transition: all 0.2s ease;
            font-family: 'Times New Roman', serif;
            flex: 1;
        }

        .key:hover {
            background: #3498db;
            color: white;
            border-color: #2980b9;
            transform: translateY(-2px);
        }

        .keyboard-controls {
            padding: 20px;
            background: #f8f9fa;
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            border-radius: 0 0 15px 15px;
        }

        .control-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .btn-danger { background: #e74c3c; color: white; }
        .btn-success { background: #2ecc71; color: white; }
        .btn-primary { background: #3498db; color: white; }

        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–æ–≤ */
        .placeholder {
            background: #fff3cd;
            border: 2px dashed #ffc107;
            color: #856404;
            padding: 4px 8px;
            border-radius: 4px;
            margin: 0 2px;
            cursor: pointer;
            display: inline-block;
        }

        .placeholder.filled {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }

        /* –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å—Ç–∏–ª–∏ */
        .sup {
            vertical-align: super;
            font-size: 0.7em;
        }

        .sub {
            vertical-align: sub;
            font-size: 0.7em;
        }

        .fraction {
    display: inline-flex;
    flex-direction: column;
    align-items: center;
    margin: 0 3px;
    vertical-align: middle;
}




        .numerator {
    display: block;
    padding: 0 5px;
    font-size: 0.9em;
    border-bottom: 3px solid black; /* –ñ–ò–†–ù–ê–Ø –ª–∏–Ω–∏—è */
}

.denominator {
    display: block;
    padding: 0 5px;
    font-size: 0.9em;
}

        .sqrt {
            position: relative;
            padding-left: 10px;
        }

        .sqrt::before {
            content: "‚àö";
            position: absolute;
            left: 0;
            top: -2px;
            font-size: 1.2em;
        }

        .superscript {
    font-size: 0.7em;
    vertical-align: super;
    line-height: 1;
}

.subscript {
    font-size: 0.7em;
    vertical-align: sub;
    line-height: 1;
}







.integral-with-limits {
    display: inline-flex;
    flex-direction: column;
    align-items: center;
    vertical-align: middle;
    margin: 0 5px;
}

.integral-upper {
    font-size: 0.7em;
    line-height: 1;
    margin-bottom: 1px;
}

.integral-lower {
    font-size: 0.7em;
    line-height: 1;
    margin-top: 1px;
}

.integral-symbol {
    font-size: 1.6em;
    line-height: 1;
}
/* –°—Ç–∏–ª—å –¥–ª—è –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∫–æ—Ä–Ω—è */
.sqrt-symbol {
    display: inline-flex;
    align-items: center;
    vertical-align: middle;
    font-family: "Times New Roman", serif;
}

.sqrt-symbol svg {
    display: inline-block;
    vertical-align: middle;
}

.sqrt-content {
    border-top: 2px solid currentColor;
    padding: 0 12px;
    margin-left: -10px;
    font-style: italic;
    font-size: 1.1em;
}
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ –∫–æ—Ä–Ω—è —Å —á–µ—Ä—Ç–æ–π */
.math-formula-display span[style*="inline-flex"] {
    display: inline-flex !important;
    align-items: center !important;
    position: relative !important;
}

.math-formula-display .superscript {
    font-size: 0.7em;
    vertical-align: super;
    line-height: 1;
    margin-right: 2px;
    position: relative;
    top: -5px;
}

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π */
.image-upload-section {
    margin: 15px 0;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 10px;
    border: 2px dashed #dee2e6;
}

.upload-label {
    display: block;
    font-weight: 600;
    margin-bottom: 8px;
    color: #495057;
    font-size: 14px;
}

.upload-label.small {
    font-size: 12px;
    margin-bottom: 5px;
}

.image-upload-input {
    width: 100%;
    padding: 10px;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    background: white;
    font-size: 14px;
}

.image-upload-input.small {
    padding: 8px;
    font-size: 12px;
}

.image-preview {
    margin-top: 10px;
    display: none;
}

.image-preview img {
    max-width: 200px;
    max-height: 150px;
    border-radius: 8px;
    border: 2px solid #dee2e6;
}

.image-preview.small img {
    max-width: 120px;
    max-height: 80px;
}

.answer-image-upload {
    margin-bottom: 10px;
    padding: 10px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px dashed #dee2e6;
}
/* –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –æ—Ç–≤–µ—Ç–æ–≤ */
.answer-image-upload {
    margin-bottom: 10px;
    padding: 10px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px dashed #dee2e6;
}

.upload-label {
    display: block;
    font-weight: 600;
    margin-bottom: 8px;
    color: #495057;
    font-size: 14px;
}

.upload-label.small {
    font-size: 12px;
    margin-bottom: 5px;
}

.image-upload-input {
    width: 100%;
    padding: 10px;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    background: white;
    font-size: 14px;
}

.image-upload-input.small {
    padding: 8px;
    font-size: 12px;
}

.image-preview {
    margin-top: 10px;
    display: none;
}

.image-preview img {
    max-width: 200px;
    max-height: 150px;
    border-radius: 8px;
    border: 2px solid #dee2e6;
}

.image-preview.small img {
    max-width: 120px;
    max-height: 80px;
}
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –æ—Ç–≤–µ—Ç–æ–≤ */
.answer-image-upload {
    margin-bottom: 10px;
    padding: 10px;
    background: #f8f9fa;
    border-radius: 8px;
    border: 1px dashed #dee2e6;
}

.upload-label {
    display: block;
    font-weight: 600;
    margin-bottom: 8px;
    color: #495057;
    font-size: 14px;
}

.upload-label.small {
    font-size: 12px;
    margin-bottom: 5px;
}

.image-upload-input {
    width: 100%;
    padding: 10px;
    border: 2px solid #e9ecef;
    border-radius: 8px;
    background: white;
    font-size: 14px;
}

.image-upload-input.small {
    padding: 8px;
    font-size: 12px;
}

.image-preview {
    margin-top: 10px;
    display: none;
}

.image-preview img {
    max-width: 200px;
    max-height: 150px;
    border-radius: 8px;
    border: 2px solid #dee2e6;
}

.image-preview.small img {
    max-width: 120px;
    max-height: 80px;
}

        .question-block {
    background: white;
    border-radius: 12px;
    padding: 24px;
    margin-bottom: 24px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    border: 1px solid #e9ecef;
}

.question-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
}

.question-title {
    color: #2c3e50;
    margin: 0;
}

.remove-btn {
    background: #dc3545;
    color: white;
    border: none;
    border-radius: 6px;
    padding: 8px 12px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 4px;
}

.answers-container {
    margin: 20px 0;
}

.answer-block {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 12px;
    border: 1px solid #e9ecef;
    position: relative;
}

.remove-answer-btn {
    position: absolute;
    top: 1px;
    right: 1px;
    background: #6c757d;
    color: white;
    border: none;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
}

        /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è */
.image-upload-section {
    margin: 20px 0;
}

/* –ú–µ—Ç–∫–∞ */
.upload-label {
    display: block;
    margin-bottom: 12px;
    font-weight: 600;
    color: #374151;
    font-size: 16px;
}

/* –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ */
.image-upload-horizontal {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 15px;
    border: 2px dashed #d1d5db;
    border-radius: 12px;
    background: #f9fafb;
    transition: all 0.3s ease;
    position: relative;
    min-height: 80px;
}

.image-upload-horizontal:hover {
    border-color: #6366f1;
    background: #f0f4ff;
}

/* –ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è */
.image-preview-horizontal {
    width: 120px;
    height: 80px;
    object-fit: cover;
    border-radius: 8px;
    border: 2px solid #e5e7eb;
    display: none;
}

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–µ–≤—å—é */
.image-preview-container {
    display: flex;
    align-items: center;
    gap: 15px;
}

/* –ö–æ–≥–¥–∞ –µ—Å—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ */
.image-upload-horizontal.has-image .upload-placeholder-horizontal {
    display: none;
}

.image-upload-horizontal.has-image .image-preview-horizontal {
    display: block;
}

/* –ü–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ */
.upload-placeholder-horizontal {
    display: flex;
    align-items: center;
    gap: 12px;
    flex: 1;
    cursor: pointer;
    padding: 10px;
}

.placeholder-icon-horizontal {
    width: 40px;
    height: 40px;
    background: #6366f1;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 18px;
}

.placeholder-text-horizontal {
    display: flex;
    flex-direction: column;
}

.placeholder-title-horizontal {
    font-weight: 600;
    color: #374151;
    font-size: 14px;
}

.placeholder-subtitle-horizontal {
    color: #6b7280;
    font-size: 12px;
}

/* –°–∫—Ä—ã—Ç—ã–π –∏–Ω–ø—É—Ç */
.image-upload-input {
    position: absolute;
    opacity: 0;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    cursor: pointer;
}

/* –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è */
.remove-image-btn-horizontal {
    position: absolute;
    top: -8px;
    right: -8px;
    width: 24px;
    height: 24px;
    background: #ef4444;
    border: none;
    border-radius: 50%;
    color: white;
    cursor: pointer;
    display: none;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    z-index: 10;
}

.image-preview-container:hover .remove-image-btn-horizontal {
    display: flex;
}

/* –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–º —Ñ–∞–π–ª–µ */
.file-info-horizontal {
    display: none;
    align-items: center;
    gap: 10px;
    margin-left: auto;
}

.image-upload-horizontal.has-image .file-info-horizontal {
    display: flex;
}

.file-name-horizontal {
    font-size: 14px;
    color: #374151;
    font-weight: 500;
}

.file-size-horizontal {
    font-size: 12px;
    color: #6b7280;
    background: #f3f4f6;
    padding: 2px 8px;
    border-radius: 12px;
}

        /* –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –æ—Ç–≤–µ—Ç–∞ */
.answer-content-horizontal {
    display: flex;
    align-items: center;
    gap: 15px;
    width: 100%;
}

/* –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ –æ—Ç–≤–µ—Ç–∞ */
.answer-text-input-horizontal {
    flex: 1;
    min-width: 200px;
    padding: 12px 16px;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    font-size: 14px;
    background: white;
    transition: all 0.3s ease;
}

.answer-text-input-horizontal:focus {
    border-color: #6366f1;
    outline: none;
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

.answer-text-input-horizontal::placeholder {
    color: #9ca3af;
}

/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ */
.answer-image-upload-horizontal {
    position: relative;
    min-width: 120px;
    height: 60px;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è */
.image-upload-horizontal-small {
    width: 120px;
    height: 60px;
    border: 2px dashed #d1d5db;
    border-radius: 8px;
    background: #f9fafb;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.image-upload-horizontal-small:hover {
    border-color: #6366f1;
    background: #f0f4ff;
}

/* –ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ */
.image-preview-horizontal-small {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 6px;
    display: none;
}

/* –ò–∫–æ–Ω–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ */
.upload-icon-horizontal {
    width: 24px;
    height: 24px;
    color: #6b7280;
    transition: color 0.3s ease;
}

.image-upload-horizontal-small:hover .upload-icon-horizontal {
    color: #6366f1;
}

/* –ö–æ–≥–¥–∞ –µ—Å—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ */
.answer-image-upload-horizontal.has-image .image-preview-horizontal-small {
    display: block;
}

.answer-image-upload-horizontal.has-image .upload-icon-horizontal {
    display: none;
}

/* –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è */
.remove-image-btn-horizontal-small {
    position: absolute;
    top: -6px;
    right: -6px;
    width: 20px;
    height: 20px;
    background: #ef4444;
    border: none;
    border-radius: 50%;
    color: white;
    cursor: pointer;
    display: none;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: bold;
    z-index: 10;
    transition: all 0.3s ease;
}

.answer-image-upload-horizontal:hover .remove-image-btn-horizontal-small {
    display: flex;
}

.remove-image-btn-horizontal-small:hover {
    background: #dc2626;
    transform: scale(1.1);
}

/* –°–∫—Ä—ã—Ç—ã–π –∏–Ω–ø—É—Ç */
.image-upload-input-horizontal {
    position: absolute;
    opacity: 0;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    cursor: pointer;
}

/* –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç */
.correct-option-horizontal {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-left: 10px;
}

.radio-input-horizontal {
    display: none;
}

.radio-label-horizontal {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
    padding: 8px 16px;
    background: white;
    border: 2px solid #e2e8f0;
    border-radius: 20px;
    font-size: 14px;
    font-weight: 600;
    color: #64748b;
    white-space: nowrap;
    transition: all 0.3s ease;
}

.radio-label-horizontal:hover {
    border-color: #10b981;
    color: #059669;
}

.radio-input-horizontal:checked + .radio-label-horizontal {
    background: #10b981;
    border-color: #10b981;
    color: white;
}

.radio-icon-horizontal {
    font-size: 16px;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 768px) {
    .answer-content-horizontal {
        flex-direction: column;
        align-items: stretch;
        gap: 12px;
    }

    .answer-text-input-horizontal {
        min-width: auto;
    }

    .answer-image-upload-horizontal {
        align-self: flex-start;
    }

    .correct-option-horizontal {
        margin-left: 0;
        justify-content: center;
    }
}
        .correct-option {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    padding: 10px 16px;
    background: white;
    border-radius: 20px;
    transition: all 0.3s ease;
    border: 2px solid var(--border);
    max-width: 300px;
}

.correct-option:hover {
    border-color: var(--success);
    background: rgba(40, 167, 69, 0.05);
}

/* –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π radio */
.correct-option input[type="radio"] {
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
}

/* –ö–∞—Å—Ç–æ–º–Ω—ã–π —Ä–∞–¥–∏–æ –∫—Ä—É–∂–æ–∫ */
.correct-option input[type="radio"] + span::before {
    content: '';
    display: inline-block;
    width: 18px;
    height: 18px;
    border: 2px solid var(--border);
    border-radius: 50%;
    margin-right: 8px;
    transition: all 0.3s ease;
    position: relative;
    top: 2px;
}

/* –ó–ï–õ–ï–ù–´–ô —Å—Ç–∏–ª—å –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ä–∞–¥–∏–æ */
.correct-option input[type="radio"]:checked + span::before {
    border-color: #28a745;
    background: #28a745;
    box-shadow: inset 0 0 0 3px white;
}

/* –ó–ï–õ–ï–ù–´–ô —Ç–µ–∫—Å—Ç –ø—Ä–∏ –≤—ã–±–æ—Ä–µ */
.correct-option input[type="radio"]:checked + span {
    color: #28a745;
    font-weight: 600;
}

/* –ó–ï–õ–ï–ù–ê–Ø —Ä–∞–º–∫–∞ –∏ —Ñ–æ–Ω –ø—Ä–∏ –≤—ã–±–æ—Ä–µ */
.correct-option:has(input[type="radio"]:checked) {
    border-color: #28a745;
    background: linear-gradient(135deg, #f8fff9 0%, #e8f5e8 100%);
    box-shadow: 0 2px 8px rgba(40, 167, 69, 0.2);
}

/* –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –¥–æ–±–∞–≤—å—Ç–µ: */
:root {
    --border: #ddd;
    --success: #28a745;
}

        .editable {
    min-width: 20px;
    min-height: 1em;
    border: 1px dashed #ccc;
    padding: 2px 4px;
    margin: 1px;
}

.editable:focus {
    border-color: #007bff;
    outline: none;
    background: #f8f9fa;
}
        /* –°—Ç–∏–ª—å –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–≥–æ –ø–æ–ª—è */
[contenteditable="true"]:focus {
    outline: 2px solid #4CAF50 !important;
    outline-offset: 2px !important;
    background: #f0fff0 !important;
}
        .big-brackets {
    display: inline-flex;
    align-items: center;
    vertical-align: middle;
    font-family: 'Times New Roman', serif;
}

.bracket-left, .bracket-right {
    font-size: 1.5em;
    line-height: 1;
    display: flex;
    align-items: center;
}

.bracket-content {
    padding: 0 2px;
    display: inline-block;
}

/* –û—Å–æ–±—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å–∫–æ–±–æ–∫ */
.big-brackets.parentheses .bracket-left,
.big-brackets.parentheses .bracket-right {
    font-size: 1.8em;
}

.big-brackets.square .bracket-left,
.big-brackets.square .bracket-right {
    font-size: 1.6em;
    font-weight: bold;
}

.big-brackets.braces .bracket-left,
.big-brackets.braces .bracket-right {
    font-size: 1.7em;
    font-weight: bold;
}

/* –ê–≤—Ç–æ–ø–æ–¥—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ —Å–∫–æ–±–æ–∫ –ø–æ–¥ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ */
.big-brackets:has(.fraction) .bracket-left,
.big-brackets:has(.fraction) .bracket-right {
    font-size: 2em;
}

.big-brackets:has(.big-brackets) .bracket-left,
.big-brackets:has(.big-brackets) .bracket-right {
    font-size: 2.2em;
}

        .subscript {
    font-size: 0.7em;
    vertical-align: sub;
    line-height: 1;
    display: inline-block;
}

/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –≤–≤–æ–¥–∞ */
.custom-input-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 2000;
    display: flex;
    align-items: center;
    justify-content: center;
}

.custom-input-backdrop {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
}

.custom-input-container {
    background: white;
    border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    width: 90%;
    max-width: 400px;
    z-index: 2001;
    position: relative;
}

.custom-input-header {
    background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    color: white;
    padding: 20px;
    border-radius: 12px 12px 0 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.custom-input-header h3 {
    margin: 0;
    font-size: 1.2em;
}

.close-btn {
    background: none;
    border: none;
    color: white;
    font-size: 24px;
    cursor: pointer;
    padding: 0;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.custom-input-body {
    padding: 25px;
}

.custom-input-field {
    width: 100%;
    padding: 15px;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    font-size: 16px;
    margin-bottom: 20px;
    transition: border-color 0.3s ease;
}

.custom-input-field:focus {
    border-color: #6366f1;
    outline: none;
    box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
}

.custom-input-buttons {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
}

.custom-input-btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.cancel-btn {
    background: #f3f4f6;
    color: #6b7280;
}

.cancel-btn:hover {
    background: #e5e7eb;
}

.confirm-btn {
    background: #6366f1;
    color: white;
}

.confirm-btn:hover {
    background: #4f46e5;
}
        @keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

.math-keyboard-notification {
    font-family: Arial, sans-serif;
    font-size: 14px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
}

        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è */
.custom-confirm-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 10000;
    display: flex;
    align-items: center;
    justify-content: center;
}

.custom-confirm-backdrop {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(2px);
}

.custom-confirm-container {
    position: relative;
    background: white;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    width: 90%;
    max-width: 400px;
    animation: modalSlideIn 0.3s ease;
}

.custom-confirm-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 20px;
    border-bottom: 1px solid #e9ecef;
}

.custom-confirm-header h3 {
    margin: 0;
    color: #333;
    font-size: 1.2em;
    display: flex;
    align-items: center;
    gap: 8px;
}

.custom-confirm-header .close-btn {
    background: none;
    border: none;
    font-size: 1.5em;
    cursor: pointer;
    color: #6c757d;
    padding: 0;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
}

.custom-confirm-header .close-btn:hover {
    background: #f8f9fa;
    color: #333;
}

.custom-confirm-body {
    padding: 20px;
}

.custom-confirm-body p {
    margin: 0 0 20px 0;
    color: #555;
    line-height: 1.5;
}

.custom-confirm-buttons {
    display: flex;
    gap: 12px;
    justify-content: flex-end;
}

.custom-confirm-btn {
    padding: 10px 20px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 0.9em;
    font-weight: 500;
    transition: all 0.2s ease;
}

.custom-confirm-btn.cancel-btn {
    background: #6c757d;
    color: white;
}

.custom-confirm-btn.cancel-btn:hover {
    background: #5a6268;
}

.custom-confirm-btn.confirm-btn {
    background: #dc3545;
    color: white;
}

.custom-confirm-btn.confirm-btn:hover {
    background: #c82333;
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(-20px) scale(0.9);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}


        /* –°—Ç–∏–ª–∏ –¥–ª—è –Ω–æ–≤–æ–≥–æ layout */
.keyboard-layout {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 20px;
    max-height: 80vh;
}

.video-sidebar {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 20px;
    overflow-y: auto;
}

.video-section h3 {
    color: #6366f1;
    margin-bottom: 15px;
    font-size: 1.1em;
}

.video-container {
    margin-bottom: 20px;
}

.video-container video {
    width: 100%;
    border-radius: 8px;
    background: #000;
}

.video-title {
    margin-top: 8px;
    font-size: 0.9em;
    color: #374151;
    font-weight: 500;
}

.quick-tips {
    background: white;
    padding: 15px;
    border-radius: 8px;
    border: 1px solid #e5e7eb;
}

.quick-tips h4 {
    color: #059669;
    margin-bottom: 10px;
    font-size: 1em;
}

.quick-tips ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.quick-tips li {
    padding: 5px 0;
    color: #6b7280;
    font-size: 0.9em;
    position: relative;
    padding-left: 15px;
}

.quick-tips li:before {
    content: "‚Ä¢";
    color: #6366f1;
    position: absolute;
    left: 0;
}

/* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
@media (max-width: 1200px) {
    .keyboard-layout {
        grid-template-columns: 1fr;
    }

    .video-sidebar {
        display: none;
    }
}
    </style>
</head>
<body>
    <div class="math-test-container">
        <div class="main-content">
            <div class="header">
                <h1><i class="fi fi-sr-folder-math"></i> –°–æ–∑–¥–∞—Ç—å –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¢–µ—Å—Ç</h1>
            </div>

            <div class="content">
                <form method="post" id="mathTestForm"  enctype="multipart/form-data">
                    {% csrf_token %}

                    <!-- –¢–∏–ø –≤–æ–ø—Ä–æ—Å–∞ -->


                    <!-- –í–æ–ø—Ä–æ—Å -->


                    <!-- –û—Ç–≤–µ—Ç—ã -->
                    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤—Å–µ—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ -->
                    <div id="questions-container">
                        <!-- –í–æ–ø—Ä–æ—Å—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ -->
                    </div>

                    <div class="buttons-container">
                        <button type="button" class="btn add-btn" onclick="addQuestion()">
                            <i class="fi fi-sr-seal-question"></i> –î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å
                        </button>

                        <button type="submit" class="btn submit-btn">
                            <i class="fi fi-sr-check-circle"></i> –ó–∞–≤–µ—Ä—à–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
        <div class="help-sidebar">
            <h2>üéØ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É</h2>

            <div class="help-item">
                <h4>üî§ 1. –ù–∞—á–Ω–∏—Ç–µ —Å –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤</h4>
                <p>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∫–ª–∞–¥–∫—É <strong>"–û—Å–Ω–æ–≤–Ω—ã–µ"</strong> –¥–ª—è —Ü–∏—Ñ—Ä, –±—É–∫–≤ –∏ –ø—Ä–æ—Å—Ç—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π: + - √ó √∑ = ( )</p>
            </div>

            <div class="help-item">
                <h4>üìê 2. –î–æ–±–∞–≤—å—Ç–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏</h4>
                <p>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫–∏:</p>
                <ul>
                    <li><strong>–ê–ª–≥–µ–±—Ä–∞</strong> - –¥—Ä–æ–±–∏, –∫–æ—Ä–Ω–∏, —Å—Ç–µ–ø–µ–Ω–∏</li>
                    <li><strong>–ì–µ–æ–º–µ—Ç—Ä–∏—è</strong> - —Ç—Ä–∏–≥–æ–Ω–æ–º–µ—Ç—Ä–∏—è, –≥—Ä–µ—á–µ—Å–∫–∏–µ –±—É–∫–≤—ã</li>
                    <li><strong>–ú–∞—Ç–∞–Ω–∞–ª–∏–∑</strong> - –∏–Ω—Ç–µ–≥—Ä–∞–ª—ã, –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ, –ø—Ä–µ–¥–µ–ª—ã</li>
                </ul>
            </div>

            <div class="help-item">
                <h4>‚ñ° 3. –ó–∞–ø–æ–ª–Ω—è–π—Ç–µ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã</h4>
                <p>–ù–∞–∂–∏–º–∞–π—Ç–µ –Ω–∞ –∫–≤–∞–¥—Ä–∞—Ç–∏–∫–∏ <strong>‚ñ°</strong> —á—Ç–æ–±—ã:</p>
                <ul>
                    <li>–í–≤–µ—Å—Ç–∏ —á–∏—Å–ª–∞ –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ</li>
                    <li>–î–æ–±–∞–≤–∏—Ç—å –¥—Ä—É–≥–∏–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è</li>
                    <li>–°–æ–∑–¥–∞—Ç—å —Å–ª–æ–∂–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã</li>
                </ul>
            </div>

            <div class="help-item">
                <h4>üîÑ 4. –†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –≤ –ª—é–±–æ–µ –≤—Ä–µ–º—è</h4>
                <p>–ú–æ–∂–Ω–æ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç:</p>
                <ul>
                    <li>–ù–∞–∂–∞—Ç—å –Ω–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–π –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è</li>
                    <li>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ‚å´ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è</li>
                    <li>–ù–∞–∂–∞—Ç—å "–û—á–∏—Å—Ç–∏—Ç—å" —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</li>
                </ul>
            </div>

            <div class="help-item">
                <h4>üíæ 5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ</h4>
                <p>–ö–æ–≥–¥–∞ —Ñ–æ—Ä–º—É–ª–∞ –≥–æ—Ç–æ–≤–∞:</p>
                <ul>
                    <li>–ù–∞–∂–º–∏—Ç–µ <strong>"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"</strong> —á—Ç–æ–±—ã –Ω–µ –ø–æ—Ç–µ—Ä—è—Ç—å</li>
                    <li>–ù–∞–∂–º–∏—Ç–µ <strong>"–í—Å—Ç–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É–ª—É"</strong> —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –≤ –≤–æ–ø—Ä–æ—Å</li>
                </ul>
            </div>

            <div class="help-examples">
                <h4>üìù –ü—Ä–∏–º–µ—Ä—ã —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–æ—Ä–º—É–ª:</h4>
                <div class="example">
                    <strong>–î—Ä–æ–±—å —Å —Å—Ç–µ–ø–µ–Ω—å—é:</strong>
                    <p>1. –ù–∞–∂–º–∏—Ç–µ "a/b" ‚Üí 2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —á–∏—Å–ª–∏—Ç–µ–ª—å ‚Üí 3. –ù–∞–∂–º–∏—Ç–µ " ‚Åø " –≤ —á–∏—Å–ª–∏—Ç–µ–ª–µ ‚Üí 4. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Å—Ç–µ–ø–µ–Ω—å</p>
                </div>
                <div class="example">
                    <strong>–ö–æ—Ä–µ–Ω—å —Å –ø–æ–∫–∞–∑–∞—Ç–µ–ª–µ–º:</strong>
                    <p>1. –ù–∞–∂–º–∏—Ç–µ "‚àöx‚Åø" ‚Üí 2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ—Å–Ω–æ–≤–∞–Ω–∏–µ ‚Üí 3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å —Å—Ç–µ–ø–µ–Ω–∏</p>
                </div>
                <div class="example">
                    <strong>–°–∫–æ–±–∫–∏ —Å –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º:</strong>
                    <p>1. –ù–∞–∂–º–∏—Ç–µ "( )" ‚Üí 2. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å–∫–æ–±–æ–∫ –ª—é–±–æ–π —Ñ–æ—Ä–º—É–ª–æ–π</p>
                </div>
            </div>

            <div class="help-tip">
                <h4>üí° –°–æ–≤–µ—Ç</h4>
                <p>–ú–æ–∂–Ω–æ –≤–∫–ª–∞–¥—ã–≤–∞—Ç—å —Ñ–æ—Ä–º—É–ª—ã –¥—Ä—É–≥ –≤ –¥—Ä—É–≥–∞! –ù–∞–ø—Ä–∏–º–µ—Ä: –¥—Ä–æ–±—å –≤–Ω—É—Ç—Ä–∏ –∫–æ—Ä–Ω—è, –∏–ª–∏ —Å—Ç–µ–ø–µ–Ω—å –≤ —á–∏—Å–ª–∏—Ç–µ–ª–µ –¥—Ä–æ–±–∏.</p>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã -->
    <div class="math-keyboard-modal" id="mathKeyboardModal">
        <div class="modal-content">
          <div class="keyboard-layout">
            <div class="keyboard-container">
                <div class="keyboard-header">
                    <h2><i class="fi fi-sr-folder-math"></i> –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞</h2>
                    <p>–°–æ–∑–¥–∞–π—Ç–µ —Ñ–æ—Ä–º—É–ª—É –∏ –Ω–∞–∂–º–∏—Ç–µ "–í—Å—Ç–∞–≤–∏—Ç—å". –ù–∞–∂–∏–º–∞–π—Ç–µ –Ω–∞ ‚ñ° —á—Ç–æ–±—ã –∑–∞–ø–æ–ª–Ω–∏—Ç—å.</p>
                </div>

                <div class="formula-display" id="formulaDisplay">
                    –í–∞—à–∞ —Ñ–æ—Ä–º—É–ª–∞ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...
                </div>

                <div class="keyboard-tabs">
                    <button class="keyboard-tab active" data-tab="basic">–û—Å–Ω–æ–≤–Ω—ã–µ</button>
                    <button class="keyboard-tab" data-tab="algebra">–ê–ª–≥–µ–±—Ä–∞</button>
                    <button class="keyboard-tab" data-tab="geometry">–ì–µ–æ–º–µ—Ç—Ä–∏—è</button>
                    <button class="keyboard-tab" data-tab="calculus">–ú–∞—Ç–∞–Ω–∞–ª–∏–∑</button>
                </div>

                <!-- –û—Å–Ω–æ–≤–Ω—ã–µ -->
                <div class="keyboard-panel active" id="basicPanel">
                    <div class="keyboard-section">
                        <div class="keyboard-row">
                            <div class="key" data-symbol="x">x</div>
                            <div class="key" data-symbol="y">y</div>
                            <div class="key" data-symbol="z">z</div>
                            <div class="key" data-symbol="a">a</div>
                            <div class="key" data-symbol="b">b</div>
                            <div class="key" data-symbol="c">c</div>

                        </div>
                    </div>

                    <div class="keyboard-section">
                        <div class="keyboard-row">
                            <div class="key" data-symbol="1">1</div>
                            <div class="key" data-symbol="2">2</div>
                            <div class="key" data-symbol="3">3</div>
                            <div class="key" data-symbol="+" style="background: #ffccd8b3;">+</div>
                            <div class="key" data-template="power">x‚Åø</div>
                            <div class="key" data-symbol="(">(</div>
                            <div class="key" data-symbol=")">)</div>
                        </div>
                        <div class="keyboard-row">
                            <div class="key" data-symbol="4">4</div>
                            <div class="key" data-symbol="5">5</div>
                            <div class="key" data-symbol="6">6</div>
                            <div class="key" data-symbol="-" style="background: #ffccd8b3;">-</div>
                            <div class="key" data-symbol="œÄ">œÄ</div>
                            <div class="key" data-symbol="[">[</div>
                            <div class="key" data-symbol="]">]</div>
                        </div>
                        <div class="keyboard-row">
                            <div class="key" data-symbol="7">7</div>
                            <div class="key" data-symbol="8">8</div>
                            <div class="key" data-symbol="9">9</div>
                            <div class="key" data-symbol="*" style="background: #ffccd8b3;">√ó</div>
                            <div class="key" data-symbol="=">=</div>
                            <div class="key" data-symbol="{">{</div>
                            <div class="key" data-symbol="}">}</div>
                        </div>
                        <div class="keyboard-row">
                            <div class="key" data-symbol="0">0</div>
                            <div class="key" data-symbol=".">.</div>
                            <div class="key" data-symbol=",">,</div>
                            <div class="key" data-symbol=":" style="background: #ffccd8b3;">√∑</div>
                            <div class="key" data-symbol="e">e</div>
                            <div class="key" data-symbol="‚àû">‚àû</div>
                            <div class="key" data-action="backspace">‚å´</div>
                        </div>
                    </div>
                </div>

                <!-- –ê–ª–≥–µ–±—Ä–∞ -->
                <div class="keyboard-panel" id="algebraPanel">
                    <div class="keyboard-section">
                        <div class="keyboard-row">
                            <div class="key" data-template="sqrt">‚àöx</div>
                            <div class="key" data-template="sqrt_power">‚àöx‚Åø</div> <!-- –ù–û–í–ê–Ø –ö–ù–û–ü–ö–ê -->
                            <div class="key" data-template="nroot">‚Åø‚àöx</div>
                            <div class="key" data-template="square">x¬≤</div>
                            <div class="key" data-template="cube">x¬≥</div>
                            <div class="key" data-template="power">x‚Åø</div>
                            <div class="key" data-template="small_power">‚Åø</div> <!-- –ù–û–í–ê–Ø –ö–ù–û–ü–ö–ê - –¢–û–õ–¨–ö–û –ú–ê–õ–ï–ù–¨–ö–ê–Ø –°–¢–ï–ü–ï–ù–¨ -->
                        </div>

                        <div class="keyboard-row">
                            <div class="key" data-template="frac">a/b</div>
                            <div class="key" data-template="frac_power">aÀ£/bÀ£</div>
                            <div class="key" data-template="binom">C(n,k)</div>
                            <div class="key" data-template="factorial">n!</div>
                            <div class="key" data-template="abs">|x|</div>
                            <div class="key" data-template="sum">‚àë</div>
                            <div class="key" data-symbol="f">f</div>
                            <div class="key" data-symbol="F">F</div>

                        </div>

                        <div class="keyboard-row">
                            <div class="key" data-template="big_parentheses_right">(</div>
                            <div class="key" data-template="big_parentheses_left">)</div><!-- –ë–æ–ª—å—à–∏–µ –∫—Ä—É–≥–ª—ã–µ -->
                            <div class="key" data-template="big_brackets_right">[</div> <!-- –ë–æ–ª—å—à–∏–µ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ -->            <!-- –ë–æ–ª—å—à–∏–µ —Ñ–∏–≥—É—Ä–Ω—ã–µ -->
                            <div class="key" data-template="big_brackets_left">]</div>
                            <div class="key" data-template="big_braces_right">{</div> <!-- –ë–æ–ª—å—à–∏–µ —Ñ–∏–≥—É—Ä–Ω—ã–µ -->
                            <div class="key" data-template="big_braces_left">}</div>
                        </div>

                    </div>
                </div>

                <!-- –ì–µ–æ–º–µ—Ç—Ä–∏—è -->
                <div class="keyboard-panel" id="geometryPanel">
                    <div class="keyboard-section">
                        <div class="keyboard-row">
                            <div class="key" data-template="sin">sin</div>
                            <div class="key" data-template="cos">cos</div>
                            <div class="key" data-template="tan">tan</div>
                            <div class="key" data-template="cot">cot</div>
                            <div class="key" data-template="subscript">‚Çô</div>
                            <div class="key" data-template="just">(x)</div>
                        </div>
                        <div class="keyboard-row">
                            <div class="key" data-symbol="Œ±">Œ±</div>
                            <div class="key" data-symbol="Œ≤">Œ≤</div>
                            <div class="key" data-symbol="Œ≥">Œ≥</div>
                            <div class="key" data-symbol="Œ∏">Œ∏</div>
                            <div class="key" data-symbol="œÜ">œÜ</div>
                            <div class="key" data-symbol="œâ">œâ</div>
                        </div>
                    </div>
                </div>

                <!-- –ú–∞—Ç–∞–Ω–∞–ª–∏–∑ -->
                <div class="keyboard-panel" id="calculusPanel">
                    <div class="keyboard-section">
                        <div class="keyboard-row">
                            <div class="key" data-template="derivative">dy/dx</div>
                            <div class="key" data-template="partial">‚àÇf/‚àÇx</div>
                            <div class="key" data-template="integral">‚à´f(x)dx</div>
                            <div class="key" data-template="integral_limits">‚à´‚Å∞‚ÇÄ</div>
                            <div class="key" data-template="def_integral">‚à´‚Çê·µáf(x)dx</div>
                            <div class="key" data-template="integral_symbol">‚à´</div>
                        </div>
                        <div class="keyboard-row">
                            <div class="key" data-template="limit">lim</div>
                            <div class="key" data-template="series">‚àëa‚Çô</div>
                            <div class="key" data-template="nabla">‚àá</div>
                            <div class="key" data-template="laplacian">Œî</div>
                        </div>
                    </div>
                </div>

                <div class="keyboard-controls">
                    <button class="control-btn btn-danger" id="clearBtn"><i class="fi fi-ss-eraser"></i> –û—á–∏—Å—Ç–∏—Ç—å</button>
                    <button class="control-btn btn-primary" id="saveBtn"><i class="fi fi-sr-bookmark"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button class="control-btn btn-success" onclick="insertFormula()"><i class="fi fi-sr-check-circle"></i> –í—Å—Ç–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É–ª—É</button>
                    <button class="control-btn" onclick="closeMathKeyboard()"><i class="fi fi-sr-circle-x"></i> –ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            </div>
            <!-- –ü—Ä–∞–≤–∞—è —á–∞—Å—Ç—å - –≤–∏–¥–µ–æ -->
            <div class="video-sidebar">
                <div class="video-section">
                    <h3><i class="fi fi-sr-play"></i> –í–∏–¥–µ–æ-–æ–±—É—á–µ–Ω–∏–µ</h3>
                    <div class="video-container">
                        <video controls>
                            <source src="{% static 'video/clideo_editor_9b61fcb68bee422f970548f823f49dde.mp4' %}" type="video/mp4">
                            –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
                        </video>
                        <div class="video-title">–°–æ–∑–¥–∞–Ω–∏–µ —Ñ–æ—Ä–º—É–ª—ã </div>
                    </div>

                    <div class="video-container">
                        <video controls>
                            <source src="{% static 'video/clideo_editor_9b61fcb68bee422f970548f823f49dde.mp4' %}" type="video/mp4">
                            –í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –≤–∏–¥–µ–æ.
                        </video>
                        <div class="video-title">–°–æ–∑–¥–∞–Ω–∏–µ —Ñ–æ—Ä–º—É–ª—ã </div>
                    </div>
                </div>
                <div class="quick-tips">
                    <h4><i class="fi fi-sr-bulb"></i> –ë—ã—Å—Ç—Ä—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏</h4>
                    <ul>
                        <li>–ù–∞–∂–∏–º–∞–π—Ç–µ –Ω–∞ ‚ñ° –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</li>
                        <li>–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–∫–ª–∞–¥–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π</li>
                        <li>–°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ —Å–ª–æ–∂–Ω—ã–µ —Ñ–æ—Ä–º—É–ª—ã</li>
                    </ul>
                </div>
            </div>
          </div>
        </div>
    </div>

    <script>

   // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
let currentInputField = '';
let mathKeyboard = null;
let questionCount = 0;
let answerCounts = []; // –ë—É–¥–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', function() {
    addQuestion(); // –î–æ–±–∞–≤–ª—è–µ–º –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
});

// –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–æ–¥–∞–ª—å–Ω—ã–º –æ–∫–Ω–æ–º
function openMathKeyboard(field) {
    currentInputField = field;
    document.getElementById('mathKeyboardModal').classList.add('active');

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –µ—Å–ª–∏ –µ—â–µ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
    if (!mathKeyboard) {
        mathKeyboard = new MathKeyboard();
    }
}

function closeMathKeyboard() {
    document.getElementById('mathKeyboardModal').classList.remove('active');
}

// –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤—Å—Ç–∞–≤–∫–∏ —Ñ–æ—Ä–º—É–ª—ã
function insertFormula() {
    if (mathKeyboard && currentInputField) {
        const displayFormula = mathKeyboard.getFinalFormulaForDisplay();

        if (currentInputField.startsWith('question_')) {
            const questionIndex = currentInputField.split('_')[1];
            document.getElementById(`mathExpression_${questionIndex}`).value = displayFormula;
            document.getElementById(`questionMathPreview_${questionIndex}`).innerHTML = displayFormula;
        } else if (currentInputField.startsWith('answer_')) {
            const parts = currentInputField.split('_');
            const questionIndex = parts[1];
            const answerIndex = parts[2];

            document.getElementById(`answerFormula_${questionIndex}_${answerIndex}`).value = displayFormula;
            document.getElementById(`answerPreview_${questionIndex}_${answerIndex}`).innerHTML = displayFormula;
        }
    }
    closeMathKeyboard();
}

function addQuestion() {
    const questionsContainer = document.getElementById('questions-container');
    const newQuestionIndex = questionCount;

    const newQuestion = `
        <div class="question-block" data-question-index="${newQuestionIndex}">
            <div class="question-header">
                <h3 class="question-title">
                    <i class="fi fi-sr-seal-question"></i> –í–æ–ø—Ä–æ—Å ${newQuestionIndex + 1}
                </h3>
                <button type="button" class="remove-btn" onclick="removeQuestion(${newQuestionIndex})"
                        ${newQuestionIndex === 0 ? 'style="display: none;"' : ''}>
                    <i class="fi fi-br-x"></i>
                </button>
            </div>

            <!-- –¢–∏–ø –≤–æ–ø—Ä–æ—Å–∞ -->
            <div class="format-section">
                <h4><i class="fi fi-br-bullseye-arrow"></i> –¢–∏–ø –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞:</h4>
                <div class="format-buttons">
                    <label class="format-button">
                        <input type="radio" name="question_format_${newQuestionIndex}" value="math_formula" checked>
                        <div class="format-button-content">
                            <span class="format-icon">‚à´</span>
                            <span class="format-text">
                                <strong>–§–æ—Ä–º—É–ª—ã</strong>
                                <small>–í—ã–±–æ—Ä —Ñ–æ—Ä–º—É–ª—ã</small>
                            </span>
                        </div>
                    </label>

                    <label class="format-button">
                        <input type="radio" name="question_format_${newQuestionIndex}" value="math_equation">
                        <div class="format-button-content">
                            <span class="format-icon">=</span>
                            <span class="format-text">
                                <strong>–£—Ä–∞–≤–Ω–µ–Ω–∏—è</strong>
                                <small>–†–µ—à–µ–Ω–∏–µ —É—Ä–∞–≤–Ω–µ–Ω–∏–π</small>
                            </span>
                        </div>
                    </label>
                </div>
            </div>

            <!-- –¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞ -->
            <div class="input-group">
                <textarea name="question_text_${newQuestionIndex}" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞..." rows="3" required></textarea>
            </div>

           <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞ –≤ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–º —Å—Ç–∏–ª–µ -->
            <div class="image-upload-section">
                <label class="upload-label">
                    <i class="fi fi-sr-camera"></i> –î–æ–±–∞–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫ –≤–æ–ø—Ä–æ—Å—É (–≥—Ä–∞—Ñ–∏–∫–∏, –¥–∏–∞–≥—Ä–∞–º–º—ã)
                </label>

                <div class="image-upload-horizontal" id="imageUpload_${newQuestionIndex}">
                    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–µ–≤—å—é -->
                    <div class="image-preview-container">
                        <img class="image-preview-horizontal"
                             id="questionImagePreview_${newQuestionIndex}"
                             alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä">
                        <button type="button" class="remove-image-btn-horizontal"
                                onclick="removeQuestionImage(${newQuestionIndex})">
                            √ó
                        </button>
                    </div>

                    <!-- –ü–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä -->
                    <div class="upload-placeholder-horizontal">
                        <div class="placeholder-icon-horizontal">
                            <i class="fi fi-sr-camera"></i>
                        </div>
                        <div class="placeholder-text-horizontal">
                            <span class="placeholder-title-horizontal">–ù–∞–∂–º–∏—Ç–µ —á—Ç–æ–±—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</span>
                            <span class="placeholder-subtitle-horizontal">PNG, JPG, WEBP –¥–æ 5MB</span>
                        </div>
                    </div>

                    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–π–ª–µ -->
                    <div class="file-info-horizontal">
                        <span class="file-name-horizontal" id="fileName_${newQuestionIndex}"></span>
                        <span class="file-size-horizontal" id="fileSize_${newQuestionIndex}"></span>
                    </div>

                    <!-- –°–∫—Ä—ã—Ç—ã–π –∏–Ω–ø—É—Ç -->
                    <input type="file" name="question_image_${newQuestionIndex}"
                           accept="image/*" class="image-upload-input"
                           onchange="handleQuestionImageUpload(this, ${newQuestionIndex})">
                </div>
            </div>

            <!-- –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ–æ—Ä–º—É–ª–∞ –≤–æ–ø—Ä–æ—Å–∞ -->
            <div class="math-formula-section">
                <button type="button" class="keyboard-toggle" onclick="openMathKeyboard('question_${newQuestionIndex}')">
                    <i class="fi fi-sr-folder-math"></i> –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Ñ–æ—Ä–º—É–ª—É –∫ –≤–æ–ø—Ä–æ—Å—É
                </button>
                <div id="questionMathPreview_${newQuestionIndex}" class="math-preview">
                    –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–æ—Ä–º—É–ª—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å...
                </div>
                <input type="hidden" name="math_expression_${newQuestionIndex}" id="mathExpression_${newQuestionIndex}" value="">
            </div>

            <!-- –û—Ç–≤–µ—Ç—ã -->
            <h4 class="answers-title"><i class="fi fi-br-answer-alt"></i> –û—Ç–≤–µ—Ç—ã</h4>
            <div id="answers-${newQuestionIndex}" class="answers-container">
                <!-- –û—Ç–≤–µ—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
            </div>

            <button type="button" class="btn add-answer-btn" onclick="addAnswer(${newQuestionIndex})">
                <i class="fi fi-br-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç
            </button>
        </div>
    `;

    questionsContainer.insertAdjacentHTML('beforeend', newQuestion);
    answerCounts[newQuestionIndex] = 0;

    // –î–æ–±–∞–≤–ª—è–µ–º 2 –Ω–∞—á–∞–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–∞
    addAnswer(newQuestionIndex);
    addAnswer(newQuestionIndex);

    questionCount++;
    setupImagePreviews();
}

function addAnswer(questionIndex) {
    const answersContainer = document.getElementById(`answers-${questionIndex}`);
    const answerCount = answerCounts[questionIndex];
    const newAnswerIndex = answerCount;

    const newAnswer = `
        <div class="answer-block" data-answer-index="${newAnswerIndex}">
            <button type="button" class="remove-answer-btn" onclick="removeAnswer(${questionIndex}, ${newAnswerIndex})"
                    ${answerCount < 2 ? 'style="display: none;"' : ''}>√ó</button>

            <div class="answer-content">
                <!-- –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π –±–ª–æ–∫ –æ—Ç–≤–µ—Ç–∞ -->
<div class="answer-content-horizontal">

    <!-- –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ -->
    <input type="text"
           name="answer_text_${questionIndex}_${newAnswerIndex}"
           placeholder="–¢–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞..."
           class="answer-text-input-horizontal">

    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è -->
    <div class="answer-image-upload-horizontal"
         id="answerImageUpload_${questionIndex}_${newAnswerIndex}">

        <!-- –ü—Ä–µ–≤—å—é -->
        <img class="image-preview-horizontal-small"
             id="answerImagePreview_${questionIndex}_${newAnswerIndex}"
             alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä">

        <!-- –ò–∫–æ–Ω–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ -->
        <div class="image-upload-horizontal-small">
            <span class="upload-icon-horizontal"><i class="fi fi-sr-camera"></i></span>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è -->
        <button type="button"
                class="remove-image-btn-horizontal-small"
                onclick="removeAnswerImage(${questionIndex}, ${newAnswerIndex})">
            √ó
        </button>

        <!-- –°–∫—Ä—ã—Ç—ã–π –∏–Ω–ø—É—Ç -->
        <input type="file"
               name="answer_image_${questionIndex}_${newAnswerIndex}"
               accept="image/*"
               class="image-upload-input-horizontal"
               onchange="handleAnswerImageUpload(this, ${questionIndex}, ${newAnswerIndex})">
    </div>
</div>

                <!-- –§–æ—Ä–º—É–ª–∞ –æ—Ç–≤–µ—Ç–∞ -->
                <div class="answer-formula-section">
                    <button type="button" class="keyboard-toggle small"
                            onclick="openMathKeyboard('answer_${questionIndex}_${newAnswerIndex}')">
                        <i class="fi fi-sr-folder-math"></i> –î–æ–±–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É–ª—É –æ—Ç–≤–µ—Ç–∞
                    </button>
                    <div id="answerPreview_${questionIndex}_${newAnswerIndex}" class="math-preview small">
                        –§–æ—Ä–º—É–ª–∞ –æ—Ç–≤–µ—Ç–∞...
                    </div>
                    <input type="hidden" name="answer_formula_${questionIndex}_${newAnswerIndex}"
                           id="answerFormula_${questionIndex}_${newAnswerIndex}" value="">
                </div>

                <!-- –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç -->
                <label class="correct-option">
                    <input type="radio" name="correct_answer_${questionIndex}" value="${newAnswerIndex}"
                           ${newAnswerIndex === 0 ? 'required' : ''}>
                    <span class="correct-badge"> –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç</span>
                </label>
            </div>
        </div>
    `;

    answersContainer.insertAdjacentHTML('beforeend', newAnswer);
    answerCounts[questionIndex]++;
    setupImagePreviews();
}

function handleAnswerImageUpload(input, questionIndex, answerIndex) {
    const file = input.files[0];
    if (file) {
        const reader = new FileReader();
        const preview = document.getElementById(`answerImagePreview_${questionIndex}_${answerIndex}`);
        const uploadContainer = document.getElementById(`answerImageUpload_${questionIndex}_${answerIndex}`);

        reader.onload = function(e) {
            preview.src = e.target.result;
            uploadContainer.classList.add('has-image');
        }
        reader.readAsDataURL(file);
    }
}

function removeAnswerImage(questionIndex, answerIndex) {
    const input = document.querySelector(`input[name="answer_image_${questionIndex}_${answerIndex}"]`);
    const preview = document.getElementById(`answerImagePreview_${questionIndex}_${answerIndex}`);
    const uploadContainer = document.getElementById(`answerImageUpload_${questionIndex}_${answerIndex}`);

    input.value = '';
    preview.src = '';
    uploadContainer.classList.remove('has-image');
}
function removeQuestion(questionIndex) {
    if (questionCount > 1) {
        const questionBlock = document.querySelector(`[data-question-index="${questionIndex}"]`);
        if (questionBlock) {
            questionBlock.remove();
            questionCount--;
            renumberQuestions();
        }
    }
}

function removeAnswer(questionIndex, answerIndex) {
    const answersContainer = document.getElementById(`answers-${questionIndex}`);
    const answerBlocks = answersContainer.querySelectorAll('.answer-block');

    if (answerBlocks.length > 2) {
        const answerBlock = document.querySelector(`[data-question-index="${questionIndex}"] .answer-block[data-answer-index="${answerIndex}"]`);
        if (answerBlock) {
            answerBlock.remove();
            answerCounts[questionIndex]--;
            renumberAnswers(questionIndex);
        }
    } else {
        alert('–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 2 –æ—Ç–≤–µ—Ç–∞!');
    }
}

function renumberQuestions() {
    const questions = document.querySelectorAll('.question-block');
    questionCount = questions.length;

    questions.forEach((questionBlock, index) => {
        const newQuestionIndex = index;
        const oldQuestionIndex = parseInt(questionBlock.getAttribute('data-question-index'));

        questionBlock.setAttribute('data-question-index', newQuestionIndex);

        // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
        const title = questionBlock.querySelector('.question-title');
        title.innerHTML = `<i class="fi fi-sr-seal-question"></i> –í–æ–ø—Ä–æ—Å ${newQuestionIndex + 1}`;

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–º–µ–Ω–∞ –ø–æ–ª–µ–π –≤ –≤–æ–ø—Ä–æ—Å–µ
        questionBlock.querySelectorAll('[name*="_' + oldQuestionIndex + '"]').forEach(field => {
            const newName = field.name.replace(`_${oldQuestionIndex}`, `_${newQuestionIndex}`);
            field.name = newName;
        });

        questionBlock.querySelectorAll('[id*="_' + oldQuestionIndex + '"]').forEach(element => {
            const newId = element.id.replace(`_${oldQuestionIndex}`, `_${newQuestionIndex}`);
            element.id = newId;
        });

        // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
        questionBlock.querySelector('.keyboard-toggle').setAttribute('onclick', `openMathKeyboard('question_${newQuestionIndex}')`);
        questionBlock.querySelector('.add-answer-btn').setAttribute('onclick', `addAnswer(${newQuestionIndex})`);
        questionBlock.querySelector('.remove-btn').setAttribute('onclick', `removeQuestion(${newQuestionIndex})`);

        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç—ã
        renumberAnswers(newQuestionIndex);
    });

    // –û–±–Ω–æ–≤–ª—è–µ–º –º–∞—Å—Å–∏–≤ —Å—á–µ—Ç—á–∏–∫–æ–≤ –æ—Ç–≤–µ—Ç–æ–≤
    const newAnswerCounts = [];
    questions.forEach((_, index) => {
        const answersContainer = document.getElementById(`answers-${index}`);
        newAnswerCounts[index] = answersContainer.querySelectorAll('.answer-block').length;
    });
    answerCounts = newAnswerCounts;
}

function renumberAnswers(questionIndex) {
    const answersContainer = document.getElementById(`answers-${questionIndex}`);
    const answerBlocks = answersContainer.querySelectorAll('.answer-block');

    answerBlocks.forEach((block, newAnswerIndex) => {
        const oldAnswerIndex = parseInt(block.getAttribute('data-answer-index'));
        block.setAttribute('data-answer-index', newAnswerIndex);

        // –û–±–Ω–æ–≤–ª—è–µ–º –∏–º–µ–Ω–∞ –ø–æ–ª–µ–π
        block.querySelectorAll('[name*="_' + oldAnswerIndex + '"]').forEach(field => {
            const newName = field.name.replace(`_${oldAnswerIndex}`, `_${newAnswerIndex}`);
            field.name = newName;
        });

        block.querySelectorAll('[id*="_' + oldAnswerIndex + '"]').forEach(element => {
            const newId = element.id.replace(`_${oldAnswerIndex}`, `_${newAnswerIndex}`);
            element.id = newId;
        });

        // –û–±–Ω–æ–≤–ª—è–µ–º radio value
        const radioInput = block.querySelector('input[type="radio"]');
        radioInput.value = newAnswerIndex;

        // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
        const removeBtn = block.querySelector('.remove-answer-btn');
        removeBtn.setAttribute('onclick', `removeAnswer(${questionIndex}, ${newAnswerIndex})`);

        const formulaBtn = block.querySelector('.keyboard-toggle');
        formulaBtn.setAttribute('onclick', `openMathKeyboard('answer_${questionIndex}_${newAnswerIndex}')`);
    });

    answerCounts[questionIndex] = answerBlocks.length;

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ —É–¥–∞–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤
    answerBlocks.forEach((block, index) => {
        const removeBtn = block.querySelector('.remove-answer-btn');
        removeBtn.style.display = answerBlocks.length > 2 ? 'block' : 'none';
    });
}

function setupImagePreviews() {
    document.querySelectorAll('.image-upload-input').forEach(input => {
        input.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                const preview = this.parentElement.querySelector('.image-preview');

                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" alt="–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä">`;
                    preview.style.display = 'block';
                }
                reader.readAsDataURL(file);
            }
        });
    });
}

// –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã
document.getElementById('mathTestForm').addEventListener('submit', function(e) {
    console.log("=== –ü–†–û–í–ï–†–ö–ê –§–û–†–ú–´ –ü–ï–†–ï–î –û–¢–ü–†–ê–í–ö–û–ô ===");

    let isValid = true;
    const questions = document.querySelectorAll('.question-block');

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π –≤–æ–ø—Ä–æ—Å
    questions.forEach((question, qIndex) => {
        const questionIndex = question.getAttribute('data-question-index');
        const questionText = question.querySelector(`textarea[name="question_text_${questionIndex}"]`);
        const correctAnswer = question.querySelector(`input[name="correct_answer_${questionIndex}"]:checked`);

        console.log(`–í–æ–ø—Ä–æ—Å ${questionIndex}:`);
        console.log(`  –¢–µ–∫—Å—Ç: "${questionText.value}"`);
        console.log(`  –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:`, correctAnswer ? correctAnswer.value : '–Ω–µ –≤—ã–±—Ä–∞–Ω');

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—Å—Ç–∞ –≤–æ–ø—Ä–æ—Å–∞
        if (!questionText.value.trim()) {
            isValid = false;
            questionText.style.borderColor = '#dc3545';
            console.log(`  ‚ùå –û—à–∏–±–∫–∞: –Ω–µ—Ç —Ç–µ–∫—Å—Ç–∞ –≤–æ–ø—Ä–æ—Å–∞`);
        } else {
            questionText.style.borderColor = '';
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
        if (!correctAnswer) {
            isValid = false;
            console.log(`  ‚ùå –û—à–∏–±–∫–∞: –Ω–µ –≤—ã–±—Ä–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç`);
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤
        const answerBlocks = question.querySelectorAll('.answer-block');
        let hasValidAnswers = false;

        answerBlocks.forEach((answerBlock, aIndex) => {
            const answerText = answerBlock.querySelector(`input[name="answer_text_${questionIndex}_${aIndex}"]`).value.trim();
            const answerFormula = answerBlock.querySelector(`input[name="answer_formula_${questionIndex}_${aIndex}"]`).value;
            const answerImage = answerBlock.querySelector(`input[name="answer_image_${questionIndex}_${aIndex}"]`).files[0];

            console.log(`  –û—Ç–≤–µ—Ç ${aIndex}: —Ç–µ–∫—Å—Ç="${answerText}", —Ñ–æ—Ä–º—É–ª–∞="${answerFormula}", —Ñ–æ—Ç–æ=${answerImage ? '–µ—Å—Ç—å' : '–Ω–µ—Ç'}`);

            if (answerText || answerFormula || answerImage) {
                hasValidAnswers = true;
            }
        });

        if (!hasValidAnswers) {
            isValid = false;
            console.log(`  ‚ùå –û—à–∏–±–∫–∞: –Ω–µ—Ç –Ω–∏ –æ–¥–Ω–æ–≥–æ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞`);
        }
    });

    if (!isValid) {
        e.preventDefault();
        alert('‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è:\n- –¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞\n- –•–æ—Ç—è –±—ã –æ–¥–∏–Ω –æ—Ç–≤–µ—Ç\n- –û—Ç–º–µ—Ç—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç');
        return;
    }

    // –ï—Å–ª–∏ –≤—Å–µ —Ö–æ—Ä–æ—à–æ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
    console.log("=== –í–°–ï –î–ê–ù–ù–´–ï –§–û–†–ú–´ ===");
    const formData = new FormData(this);
    for (let [key, value] of formData.entries()) {
        if (value instanceof File) {
            console.log(`${key}: FILE - ${value.name} (${value.size} bytes)`);
        } else {
            console.log(`${key}: ${value}`);
        }
    }

    console.log("‚úÖ –§–æ—Ä–º–∞ –≤–∞–ª–∏–¥–Ω–∞, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º...");
});

// –í–ê–®–ê –ö–õ–ê–í–ò–ê–¢–£–†–ê –° –ü–õ–ï–ô–°–•–û–õ–î–ï–†–ê–ú–ò
class MathKeyboard {
    constructor() {
        this.currentFormula = '';
        this.placeholders = new Map();
        this.placeholderCounter = 0;

        // –î–û–ë–ê–í–¨–¢–ï –≠–¢–û - –ù–ê–°–¢–†–û–ô–ö–ò –ê–í–¢–û–û–ß–ò–°–¢–ö–ò
        this.autoClear = true; // true - –≤–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–æ—á–∏—Å—Ç–∫—É, false - –≤—ã–∫–ª—é—á–∏—Ç—å
        this.clearTimeout = 300000; // 5 –º–∏–Ω—É—Ç (300000 –º—Å)
        this.clearTimer = null;

        // –®–ê–ë–õ–û–ù–´
        this.templates = {
            sqrt: `<span style="display: inline-flex; align-items: center; position: relative;">
                <span style="font-size: 1.3em; margin-right: 1px;">‚àö</span>
                <span style="border-top: 2px solid currentColor; padding: 0 10px; margin-left: -3px;">{ph}</span>
            </span>`,
            sqrt_power: `<span style="display: inline-flex; align-items: center; position: relative;">
                            <span style="font-size: 1.3em; margin-right: 1px;">‚àö</span>
                            <span style="border-top: 2px solid currentColor; padding: 0 8px; margin-left: -2px;">
                                {ph1}<span class="superscript">{ph2}</span>
                            </span>
                        </span>`,
            nroot: `<span style="display: inline-flex; align-items: center; position: relative;">
                <span class="superscript" style="margin-right: 2px; position: relative; top: -5px;">{ph1}</span>
                <span style="font-size: 1.3em; margin-right: 1px;">‚àö</span>
                <span style="border-top: 2px solid currentColor; padding: 0 8px; margin-left: -2px;">{ph2}</span>
            </span>`,
            square: "{ph}<span class='superscript'>2</span>",
            cube: "{ph}<span class='superscript'>3</span>",
            power: "{ph1}<span class='superscript'>{ph2}</span>",
            frac: "<div class='fraction'><span class='numerator'>{ph1}</span><span class='denominator'>{ph2}</span></div>",
             // –î—Ä–æ–±—å —Å–æ —Å—Ç–µ–ø–µ–Ω—è–º–∏: aÀ£/bÀ£
            frac_power: `<div class='fraction'>
                <span class='numerator'>{ph1}<span class='superscript'>{ph3}</span></span>
                <span class='denominator'>{ph2}<span class='superscript'>{ph4}</span></span>
            </div>`,
            binom: "C({ph1},{ph2})",
            factorial: "{ph}!",
            abs: "|{ph}|",
            sum: "‚àë<span class='subscript'>{ph1}</span><span class='superscript'>{ph2}</span>",
            log: "log<span class='subscript'>{ph1}</span>({ph2})",
            ln: "ln({ph})",
            exp: "e<span class='superscript'>{ph}</span>",
            sin: "sin",
            cos: "cos",
            tan: "tan",
            cot: "cot",
            just: "({ph})",
            arcsin: "arcsin({ph})",
            arccos: "arccos({ph})",
            arctan: "arctan({ph})",
            sinh: "sinh({ph})",
            derivative: "<div class='fraction'><span class='numerator'>d{ph1}</span><span class='denominator'>d{ph2}</span></div>",
            partial: "‚àÇ{ph1}/‚àÇ{ph2}",
            integral: "‚à´{ph1}d{ph2}",
            integral_limits: `<div style="display: inline-block; vertical-align: middle; text-align: center; margin: 0 5px;">
                <div style="font-size: 12px;">{ph2}</div>
                <div style="font-size: 18px;">‚à´</div>
                <div style="font-size: 12px;">{ph1}</div>
            </div>`,
            def_integral: `<div style="display: inline-block; vertical-align: middle; text-align: center; margin: 0 5px;">
                <div style="font-size: 12px;">{ph2}</div>
                <div style="font-size: 18px;">‚à´</div>
                <div style="font-size: 12px;">{ph1}</div>
            </div>{ph3}d{ph4}`,
            integral_symbol: "‚à´",
            limit: "lim_{ph1}",
            series: "‚àë<span class='subscript'>{ph1}</span><span class='superscript'>{ph2}</span>",
            nabla: "‚àá{ph}",
            laplacian: "Œî{ph}",
            small_power: "<span class='superscript'>{ph}</span>",
            subscript: "<span class='subscript'>{ph}</span>",


                     // –ë–æ–ª—å—à–∏–µ –∫—Ä—É–≥–ª—ã–µ —Å–∫–æ–±–∫–∏
            big_parentheses_right: `<span class="big-brackets parentheses">
                <span class="bracket-left">(</span>

            </span>`,
            big_parentheses_left: `<span class="big-brackets parentheses">

                <span class="bracket-right">)</span>
            </span>`,

            // –ë–æ–ª—å—à–∏–µ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ —Å–∫–æ–±–∫–∏
            big_brackets_right: `<span class="big-brackets square">
                <span class="bracket-left">[</span>


            </span>`,
            big_brackets_left: `<span class="big-brackets square">

                <span class="bracket-right">]</span>
            </span>`,

            // –ë–æ–ª—å—à–∏–µ —Ñ–∏–≥—É—Ä–Ω—ã–µ —Å–∫–æ–±–∫–∏
            big_braces_right: `<span class="big-brackets braces">
                <span class="bracket-left">{</span>


            </span>`,
            big_braces_left: `<span class="big-brackets braces">


                <span class="bracket-right">}</span>
            </span>`,
        };

        this.init();
    }

    init() {
        this.loadSavedData();
        this.setupEventListeners();
        this.updateDisplay();
        this.showPanel('basic');

        this.startAutoClear();
    }

    setupEventListeners() {
        // –í–∫–ª–∞–¥–∫–∏
        document.querySelectorAll('.keyboard-tab').forEach(tab => {
            tab.addEventListener('click', (e) => {
                this.showPanel(e.target.dataset.tab);
            });
        });

        // –°–∏–º–≤–æ–ª—ã
        document.querySelectorAll('.key[data-symbol]').forEach(key => {
            key.addEventListener('click', (e) => {
                this.addSymbol(e.target.dataset.symbol);
            });
        });

        // –®–∞–±–ª–æ–Ω—ã
        document.querySelectorAll('.key[data-template]').forEach(key => {
            key.addEventListener('click', (e) => {
                this.addTemplate(e.target.dataset.template);
            });
        });

        // –ö–Ω–æ–ø–∫–∞ backspace
        document.querySelector('.key[data-action="backspace"]').addEventListener('click', () => {
            this.backspace();
        });

        // –£–ø—Ä–∞–≤–ª—è—é—â–∏–µ –∫–Ω–æ–ø–∫–∏
        document.getElementById('clearBtn').addEventListener('click', () => this.clear());
        document.getElementById('saveBtn').addEventListener('click', () => this.save());

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–æ–≤ (–¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
        document.getElementById('formulaDisplay').addEventListener('click', (e) => {
            if (e.target.classList.contains('placeholder')) {
                this.editPlaceholder(e.target.dataset.id);
            }
        });
    }

    showPanel(panelName) {
        document.querySelectorAll('.keyboard-tab').forEach(tab => {
            tab.classList.toggle('active', tab.dataset.tab === panelName);
        });

        document.querySelectorAll('.keyboard-panel').forEach(panel => {
            panel.classList.toggle('active', panel.id === panelName + 'Panel');
        });
    }

    addSymbol(symbol) {
        this.resetAutoClear();
        const display = document.getElementById('formulaDisplay');
        const activeElement = document.activeElement;

        console.log("Active element:", activeElement);

        // –ü–†–û–í–ï–†–Ø–ï–ú –†–ï–î–ê–ö–¢–ò–†–£–ï–ú–´–ï –ü–û–õ–Ø –î–†–û–ë–ò
        if (activeElement && activeElement.hasAttribute('contenteditable') && display.contains(activeElement)) {
            console.log("Adding to contenteditable field:", symbol);

            // –§–æ–∫—É—Å–∏—Ä—É–µ–º—Å—è –Ω–∞ –ø–æ–ª–µ
            activeElement.focus();

            // –î–æ–±–∞–≤–ª—è–µ–º —Å–∏–º–≤–æ–ª –≤ –ø–æ–ª–µ
            this.insertAtCursor(activeElement, symbol);
            return;
        }

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∞–∫—Ç–∏–≤–Ω—ã–π –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä (—Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞)
        const activePlaceholder = display.querySelector('.placeholder.editing');
        if (activePlaceholder) {
            console.log("Adding to placeholder:", symbol);
            const placeholderId = activePlaceholder.dataset.id;
            const currentData = this.placeholders.get(placeholderId) || { value: '' };
            currentData.value += symbol;
            this.placeholders.set(placeholderId, currentData);
            this.updateDisplay();
            return;
        }

        // –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –∞–∫—Ç–∏–≤–Ω–æ, –¥–æ–±–∞–≤–ª—è–µ–º –≤ –æ–±—â—É—é —Ñ–æ—Ä–º—É–ª—É
        console.log("Adding to formula:", symbol);
        this.currentFormula += symbol;
        this.updateDisplay();
    }


    insertAtCursor(element, html) {
        const selection = window.getSelection();

        if (selection.rangeCount > 0) {
            const range = selection.getRangeAt(0);
            range.deleteContents();

            // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ HTML
            const tempDiv = document.createElement('div');
            tempDiv.innerHTML = html;

            // –í—Å—Ç–∞–≤–ª—è–µ–º HTML —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
            const fragment = document.createDocumentFragment();
            while (tempDiv.firstChild) {
                fragment.appendChild(tempDiv.firstChild);
            }
            range.insertNode(fragment);

            // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –∫—É—Ä—Å–æ—Ä –ø–æ—Å–ª–µ –≤—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
            range.setStartAfter(fragment.lastChild);
            range.setEndAfter(fragment.lastChild);
            selection.removeAllRanges();
            selection.addRange(range);
        } else {
            // –ï—Å–ª–∏ –Ω–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏—è, –¥–æ–±–∞–≤–ª—è–µ–º –≤ –∫–æ–Ω–µ—Ü
            element.innerHTML += html;
        }

        element.focus();
        this.updateCurrentFormulaFromDisplay();
    }

    updateCurrentFormulaFromDisplay() {
        const display = document.getElementById('formulaDisplay');
        this.currentFormula = display.innerHTML;
    }

    addTemplate(templateName) {

        this.resetAutoClear();
        const display = document.getElementById('formulaDisplay');
        const activeElement = document.activeElement;

        // –ï–°–õ–ò –ï–°–¢–¨ –ê–ö–¢–ò–í–ù–û–ï –†–ï–î–ê–ö–¢–ò–†–£–ï–ú–û–ï –ü–û–õ–ï - –¥–æ–±–∞–≤–ª—è–µ–º —à–∞–±–ª–æ–Ω –í–ù–£–¢–†–¨ –Ω–µ–≥–æ
        if (activeElement && activeElement.hasAttribute('contenteditable') && display.contains(activeElement)) {
            console.log("Adding template to active editable field:", templateName);

            if (this.templates[templateName]) {
                let template = this.templates[templateName];

                // –ó–∞–º–µ–Ω—è–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã –Ω–∞ –ø—Ä–æ—Å—Ç—ã–µ —Å–∏–º–≤–æ–ª—ã –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ –≤ –ø–æ–ª–µ
                template = template.replace(/{ph1}/g, '‚ñ°').replace(/{ph2}/g, '‚ñ°').replace(/{ph}/g, '‚ñ°');

                // –í—Å—Ç–∞–≤–ª—è–µ–º —à–∞–±–ª–æ–Ω –≤ –∞–∫—Ç–∏–≤–Ω–æ–µ –ø–æ–ª–µ
                this.insertAtCursor(activeElement, template);
            }
            return;
        }

        // –°–¢–ê–†–ê–Ø –õ–û–ì–ò–ö–ê - –µ—Å–ª–∏ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–ª—è, –¥–æ–±–∞–≤–ª—è–µ–º –≤ –æ–±—â—É—é —Ñ–æ—Ä–º—É–ª—É
        if (this.templates[templateName]) {
            let template = this.templates[templateName];
            const placeholders = [];

            let phIndex = 1;
            while (template.includes(`{ph${phIndex}}`)) {
                const id = `ph_${++this.placeholderCounter}`;
                placeholders.push(id);
                template = template.replace(`{ph${phIndex}}`, this.createPlaceholder(id));
                phIndex++;
            }

            if (template.includes('{ph}')) {
                const id = `ph_${++this.placeholderCounter}`;
                placeholders.push(id);
                template = template.replace(/{ph}/g, this.createPlaceholder(id));
            }

            this.currentFormula += template;

            placeholders.forEach(id => {
                this.placeholders.set(id, { value: '', template: templateName });
            });

            this.updateDisplay();

            // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –¥–ª—è –¥—Ä–æ–±–∏
            if (templateName === 'frac2') {
                setTimeout(() => {
                    const firstEditable = display.querySelector('[contenteditable="true"]');
                    if (firstEditable) {
                        firstEditable.focus();
                        firstEditable.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }
                }, 200);
            }
        }
    }

    createPlaceholder(id) {
            return `<span class="placeholder" data-id="${id}">‚ñ°</span>`;
        }

        editPlaceholder(id) {
        const display = document.getElementById('formulaDisplay');

        // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å editing —É –≤—Å–µ—Ö –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–æ–≤
        display.querySelectorAll('.placeholder').forEach(ph => {
            ph.classList.remove('editing');
        });

        // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å editing –∫ —Ç–µ–∫—É—â–µ–º—É –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—É
        const currentPlaceholder = display.querySelector(`[data-id="${id}"]`);
        if (currentPlaceholder) {
            currentPlaceholder.classList.add('editing');
        }

        // –°–û–ó–î–ê–ï–ú –ö–ê–°–¢–û–ú–ù–û–ï –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û –≤–º–µ—Å—Ç–æ prompt
        this.showCustomInputModal(id);
    }
    // –î–û–ë–ê–í–¨–¢–ï —ç—Ç–æ—Ç –Ω–æ–≤—ã–π –º–µ—Ç–æ–¥ –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –≤–≤–æ–¥–∞:
showCustomInputModal(placeholderId) {
    // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    const modal = document.createElement('div');
    modal.className = 'custom-input-modal';
    modal.innerHTML = `
        <div class="custom-input-backdrop"></div>
        <div class="custom-input-container">
            <div class="custom-input-header">
                <h3>–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ</h3>
                <button class="close-btn">&times;</button>
            </div>
            <div class="custom-input-body">
                <input type="text"
                       class="custom-input-field"
                       placeholder="–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ –∏–ª–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ..."
                       value="${this.placeholders.get(placeholderId)?.value || ''}">
                <div class="custom-input-buttons">
                    <button class="custom-input-btn cancel-btn">–û—Ç–º–µ–Ω–∞</button>
                    <button class="custom-input-btn confirm-btn">–ì–æ—Ç–æ–≤–æ</button>
                </div>
            </div>
        </div>
    `;

    // –î–æ–±–∞–≤–ª—è–µ–º –≤ body
    document.body.appendChild(modal);

    // –§–æ–∫—É—Å–∏—Ä—É–µ–º—Å—è –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
    const inputField = modal.querySelector('.custom-input-field');
    setTimeout(() => inputField.focus(), 100);

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    const closeModal = () => {
        document.body.removeChild(modal);
        const currentPlaceholder = document.querySelector(`[data-id="${placeholderId}"]`);
        if (currentPlaceholder) {
            currentPlaceholder.classList.remove('editing');
        }
    };

    // –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
    modal.querySelector('.close-btn').addEventListener('click', closeModal);
    modal.querySelector('.cancel-btn').addEventListener('click', closeModal);

    // –ö–Ω–æ–ø–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
    modal.querySelector('.confirm-btn').addEventListener('click', () => {
        const newValue = inputField.value.trim();
        this.placeholders.set(placeholderId, {
            ...this.placeholders.get(placeholderId),
            value: newValue
        });
        this.updateDisplay();
        closeModal();
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ –±—ç–∫–¥—Ä–æ–ø
    modal.querySelector('.custom-input-backdrop').addEventListener('click', closeModal);

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ Escape
    inputField.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            closeModal();
        } else if (e.key === 'Enter') {
            modal.querySelector('.confirm-btn').click();
        }
    });
}

    backspace() {

        this.resetAutoClear();
        this.currentFormula = this.currentFormula.slice(0, -1);
        this.updateDisplay();
    }

    clear() {
    // –í–º–µ—Å—Ç–æ confirm –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–∞—Å—Ç–æ–º–Ω–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
    this.showClearConfirmationModal();
}

showClearConfirmationModal() {
    // –°–æ–∑–¥–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—á–∏—Å—Ç–∫–∏
    const modal = document.createElement('div');
    modal.className = 'custom-confirm-modal';
    modal.innerHTML = `
        <div class="custom-confirm-backdrop"></div>
        <div class="custom-confirm-container">
            <div class="custom-confirm-header">
                <h3><i class="fi fi-sr-eraser"></i> –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É–ª—É</h3>
                <button class="close-btn">&times;</button>
            </div>
            <div class="custom-confirm-body">
                <p>–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—á–∏—Å—Ç–∏—Ç—å –≤—Å—é —Ñ–æ—Ä–º—É–ª—É? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.</p>
                <div class="custom-confirm-buttons">
                    <button class="custom-confirm-btn cancel-btn">–û—Ç–º–µ–Ω–∞</button>
                    <button class="custom-confirm-btn confirm-btn btn-danger">–û—á–∏—Å—Ç–∏—Ç—å</button>
                </div>
            </div>
        </div>
    `;

    // –î–æ–±–∞–≤–ª—è–µ–º –≤ body
    document.body.appendChild(modal);

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
    const closeModal = () => {
        document.body.removeChild(modal);
    };

    // –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç–∏—è
    modal.querySelector('.close-btn').addEventListener('click', closeModal);
    modal.querySelector('.cancel-btn').addEventListener('click', closeModal);

    // –ö–Ω–æ–ø–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ—á–∏—Å—Ç–∫–∏
    modal.querySelector('.confirm-btn').addEventListener('click', () => {
        this.clearWithoutConfirm();
        closeModal();
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ –±—ç–∫–¥—Ä–æ–ø
    modal.querySelector('.custom-confirm-backdrop').addEventListener('click', closeModal);

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ Escape
    modal.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
            closeModal();
        }
    });

    // –§–æ–∫—É—Å–∏—Ä—É–µ–º—Å—è –Ω–∞ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
    modal.focus();
}

    updateDisplay() {
        let displayFormula = this.currentFormula;

        // –ó–∞–º–µ–Ω—è–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã –Ω–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        this.placeholders.forEach((data, id) => {
            const placeholderHtml = this.createPlaceholder(id);
            const displayValue = data.value ?
                `<span class="placeholder filled" data-id="${id}">${data.value}</span>` :
                placeholderHtml;

            displayFormula = displayFormula.split(placeholderHtml).join(displayValue);
        });

        const display = document.getElementById('formulaDisplay');
        display.innerHTML = displayFormula || '–í–∞—à–∞ —Ñ–æ—Ä–º—É–ª–∞ –ø–æ—è–≤–∏—Ç—Å—è –∑–¥–µ—Å—å...';

        // –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –î–õ–Ø –†–ï–î–ê–ö–¢–ò–†–£–ï–ú–´–• –ü–û–õ–ï–ô –î–†–û–ë–ò
        display.querySelectorAll('[contenteditable="true"]').forEach(editable => {
            // –£–±–∏—Ä–∞–µ–º —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
            const newEditable = editable.cloneNode(true);
            editable.parentNode.replaceChild(newEditable, editable);

            // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
            newEditable.addEventListener('input', () => {
                this.updateCurrentFormulaFromDisplay();
            });

            newEditable.addEventListener('click', (e) => {
                e.stopPropagation();
                newEditable.focus();
            });

            newEditable.addEventListener('focus', () => {
                console.log("Editable field focused:", newEditable);
            });
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä–æ–≤ (—Å—Ç–∞—Ä–∞—è –ª–æ–≥–∏–∫–∞)
        display.querySelectorAll('.placeholder').forEach(placeholder => {
            placeholder.addEventListener('click', (e) => {
                e.stopPropagation();
                this.editPlaceholder(placeholder.dataset.id);
            });
        });
    }
    getFinalFormula() {
        let finalFormula = this.currentFormula;

        this.placeholders.forEach((data, id) => {
            const placeholderHtml = this.createPlaceholder(id);
            const value = data.value || '';
            finalFormula = finalFormula.split(placeholderHtml).join(value);
        });

        return finalFormula;
    }

    getFinalFormulaForDisplay() {
        let displayFormula = this.currentFormula;

        this.placeholders.forEach((data, id) => {
            const placeholderHtml = this.createPlaceholder(id);
            const displayValue = data.value ?
                `<span class="placeholder filled" data-id="${id}">${data.value}</span>` :
                `<span class="placeholder" data-id="${id}">‚ñ°</span>`;

            displayFormula = displayFormula.split(placeholderHtml).join(displayValue);
        });

        return displayFormula;
    }

    save() {
        const data = {
            formula: this.currentFormula,
            placeholders: Array.from(this.placeholders.entries()),
            counter: this.placeholderCounter
        };

        localStorage.setItem('mathKeyboard', JSON.stringify(data));
        alert('–§–æ—Ä–º—É–ª–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!');
    }

    loadSavedData() {
        try {
            const saved = localStorage.getItem('mathKeyboard');
            if (saved) {
                const data = JSON.parse(saved);
                this.currentFormula = data.formula || '';
                this.placeholders = new Map(data.placeholders || []);
                this.placeholderCounter = data.counter || 0;
            }
        } catch (e) {
            console.log('–ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –æ—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏');
        }
    }
    // –î–û–ë–ê–í–¨–¢–ï –≠–¢–ò –ú–ï–¢–û–î–´ –ü–†–Ø–ú–û –ü–ï–†–ï–î –ó–ê–ö–†–´–í–ê–Æ–©–ï–ô –°–ö–û–ë–ö–û–ô –ö–õ–ê–°–°–ê

    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—á–∏—â–µ–Ω–∏–µ
    startAutoClear() {
        if (this.autoClear && this.clearTimeout > 0) {
            this.clearTimer = setTimeout(() => {
                this.clearWithoutConfirm();
            }, this.clearTimeout);
        }
    }

    resetAutoClear() {
        if (this.clearTimer) {
            clearTimeout(this.clearTimer);
        }
        if (this.autoClear && this.clearTimeout > 0) {
            this.startAutoClear();
        }
    }

    clearWithoutConfirm() {
    this.currentFormula = '';
    this.placeholders.clear();
    this.placeholderCounter = 0;
    this.updateDisplay();

    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤–º–µ—Å—Ç–æ alert
    this.showNotification('–§–æ—Ä–º—É–ª–∞ –æ—á–∏—â–µ–Ω–∞', 'info');
}

    showNotification(message, type = 'info') {
        const notification = document.createElement('div');
        notification.className = `math-keyboard-notification ${type}`;
        notification.textContent = message;

        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            background: ${type === 'info' ? '#2196F3' : '#f44336'};
            color: white;
            border-radius: 4px;
            z-index: 10000;
            animation: slideIn 0.3s ease;
        `;

        document.body.appendChild(notification);

        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 3000);
    }
}






        // –î–æ–±–∞–≤—å—Ç–µ —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–¥–∞–ª—è—Ç—å —Ñ–æ—Ç–æ
function removeImage(previewId) {
    const preview = document.getElementById(previewId);
    const input = preview.parentElement.querySelector('.image-upload-input');

    preview.style.display = 'none';
    preview.innerHTML = '';
    input.value = '';
}

     document.getElementById('mathTestForm').addEventListener('submit', function(e) {

    console.log("=== –û–¢–õ–ê–î–ö–ê –ü–ï–†–ï–î –û–¢–ü–†–ê–í–ö–û–ô –§–û–†–ú–´ ===");

    const answerFormulas = document.querySelectorAll('input[name="answer_formula[]"]');
    const answerImages = document.querySelectorAll('input[name="answer_images[]"]');
    const correctAnswer = document.querySelector('input[name="correct_answer"]:checked');

    console.log("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–æ—Ä–º—É–ª –æ—Ç–≤–µ—Ç–æ–≤:", answerFormulas.length);
    console.log("–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª–µ–π –¥–ª—è —Ñ–æ—Ç–æ:", answerImages.length);
    console.log("–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:", correctAnswer ? correctAnswer.value : '–Ω–µ –≤—ã–±—Ä–∞–Ω');

    // –ü—Ä–æ–≤–µ—Ä–∏–º –í–°–ï –¥–∞–Ω–Ω—ã–µ —Ñ–æ—Ä–º—ã
    const formData = new FormData(this);
    console.log("=== –í–°–ï –î–ê–ù–ù–´–ï –§–û–†–ú–´ ===");
    for (let [key, value] of formData.entries()) {
        if (key === 'answer_images[]') {
            console.log(`${key}:`, value.name, value.size, "bytes");
        } else {
            console.log(`${key}:`, value);
        }
    }

    // –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–æ—Ä–º—É –≤—Ä—É—á–Ω—É—é –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    // this.submit();
});

        function handleQuestionImageUpload(input, questionIndex) {
    const file = input.files[0];
    if (file) {
        const reader = new FileReader();
        const preview = document.getElementById(`questionImagePreview_${questionIndex}`);
        const uploadContainer = document.getElementById(`imageUpload_${questionIndex}`);
        const fileName = document.getElementById(`fileName_${questionIndex}`);
        const fileSize = document.getElementById(`fileSize_${questionIndex}`);

        reader.onload = function(e) {
            preview.src = e.target.result;
            uploadContainer.classList.add('has-image');

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∞–π–ª–µ
            fileName.textContent = file.name;
            fileSize.textContent = formatFileSize(file.size);
        }
        reader.readAsDataURL(file);
    }
}

function removeQuestionImage(questionIndex) {
    const input = document.querySelector(`input[name="question_image_${questionIndex}"]`);
    const preview = document.getElementById(`questionImagePreview_${questionIndex}`);
    const uploadContainer = document.getElementById(`imageUpload_${questionIndex}`);
    const fileName = document.getElementById(`fileName_${questionIndex}`);
    const fileSize = document.getElementById(`fileSize_${questionIndex}`);

    input.value = '';
    preview.src = '';
    uploadContainer.classList.remove('has-image');
    fileName.textContent = '';
    fileSize.textContent = '';
}

function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}
</script>
</body>
</html>